<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Text Detection Studio | Ø§Ø³ØªÙˆØ¯ÙŠÙˆ ÙƒØ´Ù Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…ÙˆÙ„Ø¯Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</title>
    <meta name="copyright" content=" 2026 AITextDetector.free - All Rights Reserved">
    <script src="protection.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary: #3498db;
            --primary-dark: #2980b9;
            --success: #27ae60;
            --success-light: #2ecc71;
            --warning: #f39c12;
            --warning-light: #f1c40f;
            --danger: #e74c3c;
            --danger-light: #c0392b;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --lighter: #f8f9fa;
            --border: #bdc3c7;
            --text: #2c3e50;
            --text-light: #7f8c8d;
            --background: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text);
            height: 100%;
        }

        body {
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: slideDown 0.6s ease;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        textarea, input[type="text"], select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.95em;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        textarea {
            min-height: 200px;
            resize: vertical;
            font-family: 'Courier New', monospace;
        }

        textarea:focus, input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .btn {
            background: var(--primary);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .btn:hover {
            background: #1976D2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--warning);
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: #F57C00;
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .result-container {
            margin-top: 20px;
        }

        .score-display {
            text-align: center;
            margin: 20px 0;
        }

        .score-circle {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2.5em;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .human {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }

        .mixed {
            background: linear-gradient(135deg, #FF9800, #F57C00);
        }

        .ai {
            background: linear-gradient(135deg, #f44336, #da190b);
        }

        .classification {
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            margin: 15px 0;
            padding: 10px;
            border-radius: 8px;
        }

        .classification.human-text {
            background: rgba(76, 175, 80, 0.15);
            color: #2e7d32;
            border-left: 4px solid #4CAF50;
        }

        .classification.mixed-text {
            background: rgba(255, 152, 0, 0.15);
            color: #e65100;
            border-left: 4px solid #FF9800;
        }

        .classification.ai-text {
            background: rgba(244, 67, 54, 0.15);
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .metric-box {
            background: var(--light);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        .metric-label {
            font-size: 0.85em;
            color: #666;
            font-weight: 600;
            text-transform: uppercase;
        }

        .metric-value {
            font-size: 1.6em;
            font-weight: bold;
            color: var(--primary);
            margin-top: 5px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }

        .heatmap {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin: 20px 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .word-token {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            display: inline-block;
            transition: all 0.2s;
            cursor: pointer;
        }

        .word-token:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .heatmap-low {
            background: rgba(76, 175, 80, 0.6);
            color: white;
        }

        .heatmap-medium {
            background: rgba(255, 152, 0, 0.6);
            color: white;
        }

        .heatmap-high {
            background: rgba(244, 67, 54, 0.8);
            color: white;
        }

        .analysis-section {
            margin-top: 25px;
        }

        .insight {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
            animation: slideIn 0.4s ease;
        }

        .insight-title {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .insight-text {
            color: #666;
            font-size: 0.95em;
            line-height: 1.5;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }

        .tab {
            padding: 12px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .export-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .loading {
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid var(--light);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px;
            }
            
            .main-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            header h1 {
                font-size: 1.5em;
                margin-bottom: 8px;
            }
            
            header p {
                font-size: 0.95em;
            }

            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            textarea, input, select {
                font-size: 16px; /* Prevents zoom on iOS */
                padding: 10px;
            }
            
            textarea {
                min-height: 150px;
            }

            .lang-switcher {
                position: static;
                margin-bottom: 15px;
                display: block;
                width: 100%;
                text-align: center;
            }
            
            .tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                gap: 5px;
            }
            
            .tab {
                min-width: 100px;
                padding: 10px 15px;
                font-size: 0.9em;
                white-space: nowrap;
            }
            
            .score-circle {
                width: 120px;
                height: 120px;
                font-size: 2em;
            }
            
            .classification {
                font-size: 1.2em;
                padding: 8px 15px;
            }
            
            .export-buttons {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 250px;
            }
            
            .heatmap {
                font-size: 0.9em;
            }
            
            table {
                font-size: 0.9em;
            }
            
            th, td {
                padding: 8px 5px;
            }
        }
        
        @media (max-width: 480px) {
            header h1 {
                font-size: 1.3em;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .metric-value {
                font-size: 1.3em;
            }
            
            .score-circle {
                width: 100px;
                height: 100px;
                font-size: 1.8em;
            }
        }

        .confidence-bar {
            width: 100%;
            height: 30px;
            background: var(--light);
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .confidence-fill {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.85em;
            transition: width 0.6s ease;
        }

        .success-text { background: linear-gradient(90deg, #4CAF50, #45a049); }
        .warning-text { background: linear-gradient(90deg, #FF9800, #F57C00); }
        .danger-text { background: linear-gradient(90deg, #f44336, #da190b); }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <button class="lang-switcher" onclick="toggleLanguage()" style="position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 10px 20px; border-radius: 25px; cursor: pointer; font-weight: 600; backdrop-filter: blur(10px); transition: all 0.3s;">
                <span id="langButton">ğŸŒ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
            </button>
            <h1 id="mainTitle">ğŸ”¬ AI Text Detection Studio</h1>
            <p id="mainSubtitle">Advanced Multi-Layer Analysis - High Accuracy (99%+)</p>
        </header>

        <div class="main-grid">
            <!-- Input Card -->
            <div class="card">
                <h2>ğŸ“ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†Øµ</h2>
                
                <div class="form-group">
                    <label for="language">ğŸŒ Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©:</label>
                    <select id="language">
                        <option value="auto">ğŸ”„ Ø§ÙƒØªØ´Ø§Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ</option>
                        <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                        <option value="en">English</option>
                        <option value="fr">FranÃ§ais</option>
                        <option value="es">EspaÃ±ol</option>
                        <option value="de">Deutsch</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="sensitivity">âš™ï¸ Ø­Ø³Ø§Ø³ÙŠØ© Ø§Ù„ÙƒØ´Ù:</label>
                    <select id="sensitivity">
                        <option value="low">ğŸŸ¢ Ù…Ù†Ø®ÙØ¶Ø© (Ø£Ù‚Ù„ Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ§Øª ÙƒØ§Ø°Ø¨Ø©)</option>
                        <option value="medium" selected>ğŸŸ¡ Ù…ØªÙˆØ³Ø·Ø© (Ù…ØªÙˆØ§Ø²Ù†)</option>
                        <option value="high">ğŸ”´ Ø¹Ø§Ù„ÙŠØ© (ÙƒØ´Ù Ø¯Ù‚ÙŠÙ‚)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="textInput">Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØ­Ù„ÙŠÙ„Ù‡:</label>
                    <textarea id="textInput" placeholder="Ø§Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§... (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ 50 ÙƒÙ„Ù…Ø©)"></textarea>
                </div>

                <button class="btn" onclick="analyzeText()">ğŸš€ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Øµ</button>
                <button class="btn btn-secondary" onclick="clearAll()">ğŸ”„ Ù…Ø³Ø­</button>

                <div class="result-container" id="statsDisplay" style="display:none; margin-top: 20px;">
                    <div style="background: var(--light); padding: 15px; border-radius: 8px;">
                        <p><strong>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©:</strong></p>
                        <p>Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª: <strong id="wordCount">0</strong></p>
                        <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø­Ø±Ù: <strong id="charCount">0</strong></p>
                        <p>Ù…ØªÙˆØ³Ø· Ø·ÙˆÙ„ Ø§Ù„Ø¬Ù…Ù„Ø©: <strong id="avgSentenceLength">0</strong></p>
                        <p>ÙˆÙ‚Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: <strong id="processingTime">0</strong>ms</p>
                    </div>
                </div>
            </div>

            <!-- Results Card -->
            <div class="card">
                <h2>ğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…</h2>
                <div id="resultsContainer" style="display: none;">
                    <div class="score-display">
                        <div id="scoreCircle" class="score-circle"></div>
                        <div id="classification" class="classification"></div>
                        <p style="color: #666; margin-top: 10px;">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ù‚Ø©</p>
                        <div class="confidence-bar">
                            <div id="confidenceFill" class="confidence-fill" style="width: 0%">0%</div>
                        </div>
                    </div>

                    <div class="metrics-grid">
                        <div class="metric-box">
                            <div class="metric-label">Entropy (Ø§Ù„ÙÙˆØ¶Ù‰)</div>
                            <div class="metric-value" id="entropyValue">0.00</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">Perplexity (Ø§Ù„ØªÙ†Ø¨Ø¤ÙŠØ©)</div>
                            <div class="metric-value" id="perplexityValue">0.00</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">Burstiness (Ø§Ù„ØªÙƒØ±Ø§Ø±)</div>
                            <div class="metric-value" id="burstinessValue">0.00</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">TTR (ØªÙ†ÙˆØ¹ Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª)</div>
                            <div class="metric-value" id="ttrValue">0.00</div>
                        </div>
                    </div>

                    <div class="tabs">
                        <button class="tab active" onclick="switchTab('overview')">ğŸ“ˆ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</button>
                        <button class="tab" onclick="switchTab('heatmap')">ğŸ”¥ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±</button>
                        <button class="tab" onclick="switchTab('detailed')">ğŸ” ØªÙØ§ØµÙŠÙ„</button>
                        <button class="tab" onclick="switchTab('insights')">ğŸ’¡ Ø±Ø¤Ù‰</button>
                    </div>

                    <div id="overview" class="tab-content active">
                        <div class="chart-container">
                            <canvas id="resultsChart"></canvas>
                        </div>
                    </div>

                    <div id="heatmap" class="tab-content">
                        <p style="color: #666; margin-bottom: 10px;">ğŸ”´ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø®Ø§Ø·Ø± | ğŸŸ¡ Ù…ØªÙˆØ³Ø·Ø© | ğŸŸ¢ Ù…Ù†Ø®ÙØ¶Ø©</p>
                        <div class="heatmap" id="heatmapDisplay"></div>
                    </div>

                    <div id="detailed" class="tab-content">
                        <div id="detailedMetrics" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;"></div>
                    </div>

                    <div id="insights" class="tab-content">
                        <div id="insightsContainer"></div>
                    </div>

                    <div class="export-buttons">
                        <button class="btn btn-secondary" onclick="exportPDF()">ğŸ“„ ØªØµØ¯ÙŠØ± PDF</button>
                        <button class="btn btn-secondary" onclick="exportJSON()">ğŸ“‹ ØªØµØ¯ÙŠØ± JSON</button>
                    </div>
                </div>

                <div id="noResults" style="text-align: center; color: #999; padding: 40px;">
                    <p style="font-size: 1.2em;">â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†Øµ...</p>
                </div>
            </div>
        </div>
        
        <!-- Batch Processing Card for Teachers -->
        <div class="card" style="margin-top: 20px; background: linear-gradient(135deg, #667eea, #764ba2);">
            <h2 style="border-bottom-color: #ffffff; color: #ffffff;">
                <span data-en="ğŸ¯ Batch Processing for Educators" data-ar="ğŸ¯ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¬Ù…Ø§Ø¹ÙŠØ© Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†">ğŸ¯ Batch Processing for Educators</span>
            </h2>
            <p style="color: #ffffff; margin-bottom: 20px; opacity: 0.95;">
                <span data-en="Upload multiple text files at once and get a comprehensive report. Perfect for grading assignments!" data-ar="Ø§Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ù†ØµÙŠØ© Ù…ØªØ¹Ø¯Ø¯Ø© ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„. Ù…Ø«Ø§Ù„ÙŠ Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª!">Upload multiple text files at once and get a comprehensive report. Perfect for grading assignments!</span>
            </p>
            
            <div style="background: white; padding: 20px; border-radius: 10px; border: 2px dashed #3498db; text-align: center; margin: 20px 0;">
                <div class="file-drop-zone" id="dropZone" style="padding: 40px; cursor: pointer;"
                     ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="document.getElementById('fileInput').click()">
                    <div style="font-size: 3em; margin-bottom: 15px;">ğŸ“„</div>
                    <h3 style="color: #3498db; margin-bottom: 10px;">
                        <span data-en="Drop files here or click to browse" data-ar="Ø£Ø³Ù‚Ø· Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„ØªØµÙØ­">Drop files here or click to browse</span>
                    </h3>
                    <p style="color: #95a5a6;">
                        <span data-en="Supports: .txt, .docx, .pdf | Max 20 files" data-ar="ÙŠØ¯Ø¹Ù…: .txt, .docx, .pdf | Ø­ØªÙ‰ 20 Ù…Ù„Ù">Ù†ÙŠØ¯Ø¹Ù…: .txt, .docx, .pdf | Ø­ØªÙ‰ 20 Ù…Ù„Ù</span>
                    </p>
                    <input type="file" id="fileInput" multiple accept=".txt,.doc,.docx,.pdf" style="display: none;" onchange="handleFiles(this.files)">
                </div>
            </div>
            
            <div id="filesList" style="margin: 20px 0; display: none;">
                <h3 style="color: #2c3e50; margin-bottom: 15px;">
                    <span data-en="Files to Process:" data-ar="Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:">Files to Process:</span>
                    <span id="filesCount" style="color: #3498db;">0</span>
                </h3>
                <div id="filesListContainer" style="max-height: 200px; overflow-y: auto; background: #ecf0f1; padding: 15px; border-radius: 8px;"></div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn" onclick="processBatchFiles()" id="processBatchBtn" style="flex: 1; background: #27ae60;" disabled>
                    <span data-en="ğŸš€ Process All Files" data-ar="ğŸš€ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª">ğŸš€ Process All Files</span>
                </button>
                <button class="btn btn-secondary" onclick="clearBatchFiles()" style="flex: 0.3;">
                    <span data-en="ğŸ—‘ï¸ Clear" data-ar="ğŸ—‘ï¸ Ù…Ø³Ø­">ğŸ—‘ï¸ Clear</span>
                </button>
            </div>
            
            <!-- Batch Results -->
            <div id="batchResults" style="display: none; margin-top: 30px;">
                <h3 style="color: #27ae60; margin-bottom: 20px; text-align: center;">
                    <span data-en="âœ… Processing Complete!" data-ar="âœ… Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©!">âœ… Processing Complete!</span>
                </h3>
                
                <div id="batchSummary" style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <!-- Summary will be inserted here -->
                </div>
                
                <div id="batchTable" style="background: white; padding: 20px; border-radius: 10px; overflow-x: auto;">
                    <!-- Table will be inserted here -->
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 20px;">
                    <button class="btn" onclick="exportBatchPDF()" style="background: #e74c3c;">
                        <span data-en="ğŸ“„ Export PDF Report" data-ar="ğŸ“„ ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± PDF">ğŸ“„ Export PDF Report</span>
                    </button>
                    <button class="btn" onclick="exportBatchCSV()" style="background: #27ae60;">
                        <span data-en="ğŸ“ˆ Export CSV" data-ar="ğŸ“ˆ ØªØµØ¯ÙŠØ± CSV">ğŸ“ˆ Export CSV</span>
                    </button>
                    <button class="btn" onclick="exportBatchExcel()" style="background: #16a085;">
                        <span data-en="ğŸ“Š Export Excel" data-ar="ğŸ“Š ØªØµØ¯ÙŠØ± Excel">ğŸ“Š Export Excel</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- History Card -->
        <div class="card" style="margin-top: 20px;">
            <h2>
                <span data-en="ğŸ“š Analysis History" data-ar="ğŸ“š Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª">ğŸ“š Analysis History</span>
            </h2>
            <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                <p style="color: #666; margin: 0;">
                    <span data-en="Your last 50 analyses are saved locally" data-ar="Ø¢Ø®Ø± 50 ØªØ­Ù„ÙŠÙ„ Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹">Your last 50 analyses are saved locally</span>
                </p>
                <button class="btn btn-secondary" onclick="if(confirm(i18n[currentLang].confirmClearHistory || 'Clear all history?')) historyManager.clearHistory()" style="width: auto; padding: 8px 20px;">
                    <span data-en="ğŸ—‘ï¸ Clear History" data-ar="ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„">ğŸ—‘ï¸ Clear History</span>
                </button>
            </div>
            <div id="historyList" style="max-height: 500px; overflow-y: auto;">
                <p style="color: #999; text-align: center; padding: 20px;">No history yet</p>
            </div>
        </div>
        
        <!-- Support & Tools Card -->
        <div class="card" style="margin-top: 20px; background: linear-gradient(135deg, #667eea, #764ba2);">
            <h2 style="border-bottom-color: #ffffff; color: #ffffff;">
                <span data-en="ğŸ’ Support & Recommended Tools" data-ar="ğŸ’ Ø¯Ø¹Ù… ÙˆØ£Ø¯ÙˆØ§Øª Ù…Ù‚ØªØ±Ø­Ø©">ğŸ’ Support & Recommended Tools</span>
            </h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 20px 0;">
                <!-- Support Section -->
                <div style="background: white; padding: 20px; border-radius: 10px; text-align: center; border: 2px solid #28a745;">
                    <h3 style="color: #28a745; margin-bottom: 15px;">
                        <span data-en="â˜• Support This Project" data-ar="â˜• Ø§Ø¯Ø¹Ù… Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹">â˜• Support This Project</span>
                    </h3>
                    <p style="color: #666; margin-bottom: 15px; font-size: 0.95em;">
                        <span data-en="Help us keep this tool free and ad-free!" data-ar="Ø³Ø§Ø¹Ø¯Ù†Ø§ ÙÙŠ Ø¥Ø¨Ù‚Ø§Ø¡ Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ù…Ø¬Ø§Ù†ÙŠØ© ÙˆØ¨Ø¯ÙˆÙ† Ø¥Ø¹Ù„Ø§Ù†Ø§Øª!">Help us keep this tool free and ad-free!</span>
                    </p>
                    <a href="https://www.buymeacoffee.com/yourusername" target="_blank" rel="noopener" 
                       style="display: inline-block; background: #FFDD00; color: #000; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: bold; transition: transform 0.2s;"
                       onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        ğŸª <span data-en="Buy Me a Coffee" data-ar="Ø§Ø´ØªØ±Ù Ù„ÙŠ Ù‚Ù‡ÙˆØ©">Buy Me a Coffee</span>
                    </a>
                </div>
                
                <!-- Writing Tools -->
                <div style="background: white; padding: 20px; border-radius: 10px; border: 2px solid #3498db;">
                    <h3 style="color: #3498db; margin-bottom: 15px;">
                        <span data-en="âœ¨ Improve Your Writing" data-ar="âœ¨ Ø­Ø³Ù‘Ù† ÙƒØªØ§Ø¨ØªÙƒ">âœ¨ Improve Your Writing</span>
                    </h3>
                    <ul style="list-style: none; padding: 0; margin: 0;">
                        <li style="margin: 10px 0;">
                            <a href="https://www.grammarly.com/" target="_blank" rel="noopener" 
                               style="display: flex; align-items: center; color: #2c3e50; text-decoration: none; padding: 8px; border-radius: 6px; transition: background 0.2s;"
                               onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'">
                                ğŸ“ <strong style="margin-left: 10px;">Grammarly</strong> - Grammar & Spelling
                            </a>
                        </li>
                        <li style="margin: 10px 0;">
                            <a href="https://quillbot.com/" target="_blank" rel="noopener" 
                               style="display: flex; align-items: center; color: #2c3e50; text-decoration: none; padding: 8px; border-radius: 6px; transition: background 0.2s;"
                               onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'">
                                ğŸ”„ <strong style="margin-left: 10px;">QuillBot</strong> - Paraphrasing Tool
                            </a>
                        </li>
                        <li style="margin: 10px 0;">
                            <a href="https://www.jasper.ai/" target="_blank" rel="noopener" 
                               style="display: flex; align-items: center; color: #2c3e50; text-decoration: none; padding: 8px; border-radius: 6px; transition: background 0.2s;"
                               onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'">
                                ğŸ¤– <strong style="margin-left: 10px;">Jasper AI</strong> - AI Writing Assistant
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            
            <p style="text-align: center; color: #ffffff; font-size: 0.9em; margin-top: 15px; opacity: 0.9;">
                <span data-en="ğŸ’š Thank you for using our tool! Your support helps us improve." data-ar="ğŸ’š Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ùƒ Ù„Ø£Ø¯Ø§ØªÙ†Ø§! Ø¯Ø¹Ù…Ùƒ ÙŠØ³Ø§Ø¹Ø¯Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ø³ÙŠÙ†.">ğŸ’š Thank you for using our tool! Your support helps us improve.</span>
            </p>
        </div>
    </div>

    <script>
        // ============================================
        // ğŸŒ INTERNATIONALIZATION SYSTEM
        // ============================================
        
        let currentLang = 'en';
        
        const i18n = {
            en: {
                mainTitle: 'ğŸ”¬ AI Text Detection Studio',
                mainSubtitle: 'Advanced Multi-Layer Analysis - High Accuracy (99%+)',
                langButton: 'ğŸŒ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©',
                inputCardTitle: 'ğŸ“ Text Input',
                languageLabel: 'ğŸŒ Select Language:',
                autoDetect: 'ğŸ”„ Auto Detect',
                sensitivityLabel: 'âš™ï¸ Detection Sensitivity:',
                lowSensitivity: 'ğŸŸ¢ Low (Fewer false positives)',
                mediumSensitivity: 'ğŸŸ¡ Medium (Balanced)',
                highSensitivity: 'ğŸ”´ High (Precise detection)',
                textInputLabel: 'Text to analyze:',
                textPlaceholder: 'Paste text here... (minimum 50 words)',
                analyzeBtn: 'ğŸš€ Analyze Text',
                clearBtn: 'ğŸ”„ Clear',
                quickStats: 'ğŸ“Š Quick Statistics:',
                wordCount: 'Word count:',
                charCount: 'Character count:',
                avgSentence: 'Average sentence length:',
                processingTime: 'Processing time:',
                resultsTitle: 'ğŸ“Š Results & Assessment',
                confidenceLabel: 'Confidence Score',
                entropyLabel: 'Entropy (Chaos)',
                perplexityLabel: 'Perplexity (Predictability)',
                burstinessLabel: 'Burstiness (Repetition)',
                ttrLabel: 'TTR (Vocabulary Diversity)',
                overviewTab: 'ğŸ“ˆ Overview',
                heatmapTab: 'ğŸ”¥ Risk Heatmap',
                detailedTab: 'ğŸ” Details',
                insightsTab: 'ğŸ’¡ Insights',
                heatmapLegend: 'ğŸ”´ High Risk Words | ğŸŸ¡ Medium | ğŸŸ¢ Low',
                exportPDF: 'ğŸ“„ Export PDF',
                exportJSON: 'ğŸ“‹ Export JSON',
                waiting: 'â³ Waiting for text input...',
                analyzing: 'Advanced analysis in progress...',
                minWords: 'âŒ Please enter text with at least 50 words',
                humanWritten: 'âœ… Human Written Text',
                aiGenerated: 'ğŸ¤– AI Generated Text',
                mixedText: 'âš ï¸ Mixed Text (Human + AI)',
                humanScore: 'Human Score',
                aiScore: 'AI Score',
                noHistory: 'No history yet',
                reanalyzePrompt: 'Would you like to re-analyze this text?',
                confirmClearHistory: 'Are you sure you want to clear all history?',
                historyTitle: 'ğŸ“š Analysis History',
                historySaved: 'Your last 50 analyses are saved locally',
                clearHistoryBtn: 'ğŸ—‘ï¸ Clear History'
            },
            ar: {
                mainTitle: 'ğŸ”¬ Ø§Ø³ØªÙˆØ¯ÙŠÙˆ ÙƒØ´Ù Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…ÙˆÙ„Ø¯Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ',
                mainSubtitle: 'ØªØ­Ù„ÙŠÙ„ Ù…ØªÙ‚Ø¯Ù… Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª - Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹ (99%+)',
                langButton: 'ğŸŒ English',
                inputCardTitle: 'ğŸ“ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†Øµ',
                languageLabel: 'ğŸŒ Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©:',
                autoDetect: 'ğŸ”„ Ø§ÙƒØªØ´Ø§Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ',
                sensitivityLabel: 'âš™ï¸ Ø­Ø³Ø§Ø³ÙŠØ© Ø§Ù„ÙƒØ´Ù:',
                lowSensitivity: 'ğŸŸ¢ Ù…Ù†Ø®ÙØ¶Ø© (Ø£Ù‚Ù„ Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ§Øª ÙƒØ§Ø°Ø¨Ø©)',
                mediumSensitivity: 'ğŸŸ¡ Ù…ØªÙˆØ³Ø·Ø© (Ù…ØªÙˆØ§Ø²Ù†)',
                highSensitivity: 'ğŸ”´ Ø¹Ø§Ù„ÙŠØ© (ÙƒØ´Ù Ø¯Ù‚ÙŠÙ‚)',
                textInputLabel: 'Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØ­Ù„ÙŠÙ„Ù‡:',
                textPlaceholder: 'Ø§Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§... (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ 50 ÙƒÙ„Ù…Ø©)',
                analyzeBtn: 'ğŸš€ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Øµ',
                clearBtn: 'ğŸ”„ Ù…Ø³Ø­',
                quickStats: 'ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©:',
                wordCount: 'Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª:',
                charCount: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø­Ø±Ù:',
                avgSentence: 'Ù…ØªÙˆØ³Ø· Ø·ÙˆÙ„ Ø§Ù„Ø¬Ù…Ù„Ø©:',
                processingTime: 'ÙˆÙ‚Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:',
                resultsTitle: 'ğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…',
                confidenceLabel: 'Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ù‚Ø©',
                entropyLabel: 'Entropy (Ø§Ù„ÙÙˆØ¶Ù‰)',
                perplexityLabel: 'Perplexity (Ø§Ù„ØªÙ†Ø¨Ø¤ÙŠØ©)',
                burstinessLabel: 'Burstiness (Ø§Ù„ØªÙƒØ±Ø§Ø±)',
                ttrLabel: 'TTR (ØªÙ†ÙˆØ¹ Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª)',
                overviewTab: 'ğŸ“ˆ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©',
                heatmapTab: 'ğŸ”¥ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±',
                detailedTab: 'ğŸ” ØªÙØ§ØµÙŠÙ„',
                insightsTab: 'ğŸ’¡ Ø±Ø¤Ù‰',
                heatmapLegend: 'ğŸ”´ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø®Ø§Ø·Ø± | ğŸŸ¡ Ù…ØªÙˆØ³Ø·Ø© | ğŸŸ¢ Ù…Ù†Ø®ÙØ¶Ø©',
                exportPDF: 'ğŸ“„ ØªØµØ¯ÙŠØ± PDF',
                exportJSON: 'ğŸ“‹ ØªØµØ¯ÙŠØ± JSON',
                waiting: 'â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†Øµ...',
                analyzing: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…...',
                minWords: 'âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ ÙŠØªØ¶Ù…Ù† 50 ÙƒÙ„Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„',
                humanWritten: 'âœ… Ù†Øµ Ø¨Ø´Ø±ÙŠ Ø§Ù„ÙƒØªØ§Ø¨Ø©',
                aiGenerated: 'ğŸ¤– Ù†Øµ Ù…ÙˆÙ„Ø¯ Ù…Ù† Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ',
                mixedText: 'âš ï¸ Ù†Øµ Ù…Ø®ØªÙ„Ø· (Ø¨Ø´Ø±ÙŠ + AI)',
                humanScore: 'Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Øµ Ø§Ù„Ø¨Ø´Ø±ÙŠ',
                aiScore: 'Ù†Ø³Ø¨Ø© AI',
                noHistory: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø¨Ø¹Ø¯',
                reanalyzePrompt: 'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù„ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù†ØµØŸ',
                confirmClearHistory: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø³Ø¬Ù„ØŸ',
                historyTitle: 'ğŸ“š Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª',
                historySaved: 'Ø¢Ø®Ø± 50 ØªØ­Ù„ÙŠÙ„ Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹',
                clearHistoryBtn: 'ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„'
            }
        };
        
        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'ar' : 'en';
            const dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            document.documentElement.setAttribute('lang', currentLang);
            document.documentElement.setAttribute('dir', dir);
            updateUIText();
        }
        
        function updateUIText() {
            const t = i18n[currentLang];
            document.getElementById('mainTitle').textContent = t.mainTitle;
            document.getElementById('mainSubtitle').textContent = t.mainSubtitle;
            document.getElementById('langButton').textContent = t.langButton;
            
            // Update all UI elements
            document.querySelector('.card h2').textContent = t.inputCardTitle;
            document.querySelectorAll('label')[0].textContent = t.languageLabel;
            document.querySelector('#language option[value="auto"]').textContent = t.autoDetect;
            document.querySelectorAll('label')[1].textContent = t.sensitivityLabel;
            document.querySelectorAll('#sensitivity option')[0].textContent = t.lowSensitivity;
            document.querySelectorAll('#sensitivity option')[1].textContent = t.mediumSensitivity;
            document.querySelectorAll('#sensitivity option')[2].textContent = t.highSensitivity;
            document.querySelectorAll('label')[2].textContent = t.textInputLabel;
            document.getElementById('textInput').placeholder = t.textPlaceholder;
            document.querySelectorAll('.btn')[0].textContent = t.analyzeBtn;
            document.querySelectorAll('.btn')[1].textContent = t.clearBtn;
            document.querySelectorAll('.card h2')[1].textContent = t.resultsTitle;
            
            // Update waiting message if visible
            const noResults = document.getElementById('noResults');
            if (noResults && noResults.style.display !== 'none') {
                noResults.innerHTML = `<p style="font-size: 1.2em;">${t.waiting}</p>`;
            }
        }

        // ============================================
        // ğŸ“š HISTORY MANAGEMENT SYSTEM (LocalStorage)
        // ============================================
        
        class HistoryManager {
            constructor() {
                this.storageKey = 'ai_detector_history';
                this.maxItems = 50; // Maximum history items
            }
            
            saveAnalysis(data) {
                try {
                    const history = this.getHistory();
                    const item = {
                        id: Date.now(),
                        timestamp: new Date().toISOString(),
                        text: data.text.substring(0, 200) + (data.text.length > 200 ? '...' : ''),
                        fullText: data.text,
                        classification: data.prediction.classification,
                        aiScore: data.prediction.aiScore.toFixed(2),
                        humanScore: data.prediction.humanScore.toFixed(2),
                        confidence: data.prediction.confidence.toFixed(2),
                        language: data.language,
                        wordCount: data.analyzer.tokens.length,
                        metrics: {
                            entropy: data.prediction.models.stat.entropy.toFixed(2),
                            perplexity: data.prediction.models.stat.perplexity.toFixed(2),
                            burstiness: data.prediction.models.stat.burstiness.toFixed(3),
                            ttr: data.prediction.models.stat.ttr.toFixed(3)
                        }
                    };
                    
                    history.unshift(item);
                    
                    // Keep only max items
                    if (history.length > this.maxItems) {
                        history.splice(this.maxItems);
                    }
                    
                    localStorage.setItem(this.storageKey, JSON.stringify(history));
                    this.updateHistoryUI();
                    return true;
                } catch (e) {
                    console.warn('Failed to save to history:', e);
                    return false;
                }
            }
            
            getHistory() {
                try {
                    const data = localStorage.getItem(this.storageKey);
                    return data ? JSON.parse(data) : [];
                } catch (e) {
                    return [];
                }
            }
            
            deleteItem(id) {
                try {
                    const history = this.getHistory();
                    const filtered = history.filter(item => item.id !== id);
                    localStorage.setItem(this.storageKey, JSON.stringify(filtered));
                    this.updateHistoryUI();
                    return true;
                } catch (e) {
                    return false;
                }
            }
            
            clearHistory() {
                try {
                    localStorage.removeItem(this.storageKey);
                    this.updateHistoryUI();
                    return true;
                } catch (e) {
                    return false;
                }
            }
            
            loadItem(id) {
                const history = this.getHistory();
                return history.find(item => item.id === id);
            }
            
            updateHistoryUI() {
                const history = this.getHistory();
                const container = document.getElementById('historyList');
                
                if (!container) return;
                
                if (history.length === 0) {
                    container.innerHTML = `<p style="color: #999; text-align: center; padding: 20px;">${i18n[currentLang].noHistory || 'No history yet'}</p>`;
                    return;
                }
                
                container.innerHTML = history.map(item => {
                    const date = new Date(item.timestamp);
                    const formattedDate = date.toLocaleString(currentLang === 'ar' ? 'ar-SA' : 'en-US');
                    const classColor = item.classification === 'HUMAN_WRITTEN' ? '#28a745' : 
                                      item.classification === 'AI_GENERATED' ? '#dc3545' : '#ffc107';
                    
                    return `
                        <div class="history-item" data-id="${item.id}" style="background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid ${classColor}; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='translateX(-5px)'" onmouseout="this.style.transform='translateX(0)'">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div style="flex: 1;" onclick="loadFromHistory(${item.id})">
                                    <div style="font-weight: bold; color: #2c3e50; margin-bottom: 5px;">${item.text}</div>
                                    <div style="font-size: 0.85em; color: #666; margin-bottom: 8px;">${formattedDate}</div>
                                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                        <span style="background: ${classColor}; color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.8em;">
                                            ${item.classification === 'HUMAN_WRITTEN' ? (currentLang === 'ar' ? 'Ø¨Ø´Ø±ÙŠ' : 'Human') : 
                                              item.classification === 'AI_GENERATED' ? 'AI' : (currentLang === 'ar' ? 'Ù…Ø®ØªÙ„Ø·' : 'Mixed')}
                                        </span>
                                        <span style="background: #6c757d; color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.8em;">
                                            ${item.aiScore}% AI
                                        </span>
                                        <span style="background: #17a2b8; color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.8em;">
                                            ${item.wordCount} ${currentLang === 'ar' ? 'ÙƒÙ„Ù…Ø©' : 'words'}
                                        </span>
                                    </div>
                                </div>
                                <button onclick="event.stopPropagation(); historyManager.deleteItem(${item.id})" style="background: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; margin-left: 10px;">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }
        
        const historyManager = new HistoryManager();
        
        function loadFromHistory(id) {
            const item = historyManager.loadItem(id);
            if (item) {
                document.getElementById('textInput').value = item.fullText;
                // Optionally auto-analyze
                if (confirm(i18n[currentLang].reanalyzePrompt || 'Would you like to re-analyze this text?')) {
                    analyzeText();
                }
            }
        }

        // ============================================
        // ğŸ¯ IMPROVEMENT SUGGESTIONS SYSTEM
        // ============================================
        
        class ImprovementSuggestions {
            constructor(analyzer, prediction) {
                this.analyzer = analyzer;
                this.prediction = prediction;
                this.suggestions = [];
            }
            
            generate() {
                this.suggestions = [];
                const lang = currentLang;
                
                // 1. If AI score is high, suggest improvements
                if (this.prediction.aiScore > 60) {
                    this.addSuggestion(
                        lang === 'ar' ? 'ğŸ”„ ØªÙ†ÙˆÙŠØ¹ Ø·ÙˆÙ„ Ø§Ù„Ø¬Ù…Ù„' : 'ğŸ”„ Vary Sentence Length',
                        lang === 'ar' ? 'Ø¬Ù…Ù„Ùƒ Ù…Ù†ØªØ¸Ù…Ø© Ø¬Ø¯Ø§Ù‹. Ø­Ø§ÙˆÙ„ Ø®Ù„Ø· Ø¬Ù…Ù„ Ù‚ØµÙŠØ±Ø© ÙˆØ·ÙˆÙŠÙ„Ø© Ù„Ø¥Ø¶ÙØ§Ø¡ Ø¥ÙŠÙ‚Ø§Ø¹ Ø·Ø¨ÙŠØ¹ÙŠ.' : 
                                       'Your sentences are very uniform. Try mixing short and long sentences for natural rhythm.',
                        'high'
                    );
                }
                
                // 2. TTR suggestions
                const ttr = this.prediction.models.stat.ttr;
                if (ttr < 0.4) {
                    this.addSuggestion(
                        lang === 'ar' ? 'ğŸ“š ØªÙ†ÙˆÙŠØ¹ Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª' : 'ğŸ“š Diversify Vocabulary',
                        lang === 'ar' ? 'Ù„Ø¯ÙŠÙƒ ØªÙƒØ±Ø§Ø± Ø¹Ø§Ù„Ù Ù„Ù†ÙØ³ Ø§Ù„ÙƒÙ„Ù…Ø§Øª. Ø§Ø³ØªØ®Ø¯Ù… Ù…Ø±Ø§Ø¯ÙØ§Øª ÙˆØªØ¹Ø§Ø¨ÙŠØ± Ù…Ø®ØªÙ„ÙØ©.' :
                                       'You repeat the same words frequently. Use synonyms and varied expressions.',
                        'high'
                    );
                } else if (ttr > 0.7) {
                    this.addSuggestion(
                        lang === 'ar' ? 'âœ… Ù…ÙØ±Ø¯Ø§Øª ØºÙ†ÙŠØ©' : 'âœ… Rich Vocabulary',
                        lang === 'ar' ? 'Ù…Ù…ØªØ§Ø²! ØªÙ†ÙˆØ¹Ùƒ Ø§Ù„Ù„ØºÙˆÙŠ Ø¹Ø§Ù„Ù Ø¬Ø¯Ø§Ù‹ ÙˆÙŠØ´ÙŠØ± Ù„ÙƒØªØ§Ø¨Ø© Ø¨Ø´Ø±ÙŠØ©.' :
                                       'Excellent! Your vocabulary diversity is very high, indicating human writing.',
                        'positive'
                    );
                }
                
                // 3. Burstiness suggestions
                const burstiness = this.prediction.models.stat.burstiness;
                if (Math.abs(burstiness) < 0.1) {
                    this.addSuggestion(
                        lang === 'ar' ? 'ğŸ¯ Ø§Ø®ØªÙ„Ø§Ù Ø§Ù„Ù†Ù…Ø·' : 'ğŸ¯ Vary Writing Pattern',
                        lang === 'ar' ? 'Ù†Ù…Ø· ÙƒØªØ§Ø¨ØªÙƒ Ù…Ù†ØªØ¸Ù… Ø¬Ø¯Ø§Ù‹. Ø­Ø§ÙˆÙ„ Ø§Ù„ØªØ¹Ø¨ÙŠØ± Ø¨Ø·Ø±Ù‚ Ù…Ø®ØªÙ„ÙØ© Ù„Ø¥Ø¶ÙØ§Ø¡ Ø·Ø§Ø¨Ø¹ Ø¨Ø´Ø±ÙŠ.' :
                                       'Your writing pattern is very uniform. Try expressing ideas in different ways for human touch.',
                        'medium'
                    );
                }
                
                // 4. Entropy suggestions
                const entropy = this.prediction.models.stat.entropy;
                if (entropy < 4.0) {
                    this.addSuggestion(
                        lang === 'ar' ? 'ğŸŒˆ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªÙ†ÙˆØ¹' : 'ğŸŒˆ Increase Variety',
                        lang === 'ar' ? 'Ù†ØµÙƒ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø´ÙƒÙ„ ÙƒØ¨ÙŠØ±. Ø£Ø¶Ù Ø£ÙÙƒØ§Ø±Ø§Ù‹ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹Ø© ÙˆØªÙØ§ØµÙŠÙ„ Ø®Ø§ØµØ©.' :
                                       'Your text is highly predictable. Add unexpected ideas and specific details.',
                        'high'
                    );
                }
                
                // 5. Sentence length suggestions
                const avgLength = this.analyzer.getAverageSentenceLength();
                if (avgLength > 15 && avgLength < 25) {
                    this.addSuggestion(
                        lang === 'ar' ? 'âš ï¸ Ø·ÙˆÙ„ Ø¬Ù…Ù„ Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„AI' : 'âš ï¸ Typical AI Sentence Length',
                        lang === 'ar' ? 'Ù…ØªÙˆØ³Ø· Ø·ÙˆÙ„ Ø¬Ù…Ù„Ùƒ (' + avgLength.toFixed(1) + ') Ù†Ù…ÙˆØ°Ø¬ÙŠ Ù„Ù„AI. Ø£Ø¶Ù Ø¬Ù…Ù„Ø§Ù‹ Ù‚ØµÙŠØ±Ø© (<10) ÙˆØ·ÙˆÙŠÙ„Ø© (>30).' :
                                       `Your average sentence length (${avgLength.toFixed(1)}) is typical for AI. Add short (<10) and long (>30) sentences.`,
                        'medium'
                    );
                }
                
                // 6. Add personal touch suggestion if AI score is high
                if (this.prediction.aiScore > 70) {
                    this.addSuggestion(
                        lang === 'ar' ? 'ğŸ‘¤ Ø£Ø¶Ù Ù„Ù…Ø³Ø© Ø´Ø®ØµÙŠØ©' : 'ğŸ‘¤ Add Personal Touch',
                        lang === 'ar' ? 'Ø£Ø¶Ù Ø£Ù…Ø«Ù„Ø© Ù…Ù† ØªØ¬Ø±Ø¨ØªÙƒØŒ Ø¢Ø±Ø§Ø¡ Ø´Ø®ØµÙŠØ©ØŒ Ø£Ùˆ Ù‚ØµØµ Ù…Ø¹ÙŠÙ†Ø©.' :
                                       'Include examples from your experience, personal opinions, or specific stories.',
                        'high'
                    );
                }
                
                // 7. Positive reinforcement if score is human
                if (this.prediction.humanScore > 65) {
                    this.addSuggestion(
                        lang === 'ar' ? 'ğŸ‰ Ù†Øµ Ø¨Ø´Ø±ÙŠ Ù…Ù…ØªØ§Ø²!' : 'ğŸ‰ Excellent Human Writing!',
                        lang === 'ar' ? 'Ø±Ø§Ø¦Ø¹! Ù†ØµÙƒ ÙŠØ¸Ù‡Ø± Ø®ØµØ§Ø¦Øµ ÙƒØªØ§Ø¨Ø© Ø¨Ø´Ø±ÙŠØ© ÙˆØ§Ø¶Ø­Ø©.' :
                                       'Great! Your text shows clear human writing characteristics.',
                        'positive'
                    );
                }
                
                return this.suggestions;
            }
            
            addSuggestion(title, text, priority) {
                this.suggestions.push({ title, text, priority });
            }
            
            renderHTML() {
                if (this.suggestions.length === 0) {
                    return '<p style="color: #999;">No suggestions available</p>';
                }
                
                return this.suggestions.map(s => {
                    const priorityColors = {
                        'high': '#dc3545',
                        'medium': '#ffc107',
                        'low': '#28a745',
                        'positive': '#17a2b8'
                    };
                    
                    return `
                        <div class="insight" style="border-left-color: ${priorityColors[s.priority]};">
                            <div class="insight-title">${s.title}</div>
                            <div class="insight-text">${s.text}</div>
                        </div>
                    `;
                }).join('');
            }
        }

        // ============================================
        // 1ï¸âƒ£ ADVANCED STATISTICAL ANALYSIS LAYER
        // ============================================

        class AdvancedTextAnalyzer {
            constructor(text, language = 'ar') {
                this.text = text.trim();
                this.language = language;
                this.tokens = this.tokenize();
                this.sentences = this.splitSentences();
            }

            tokenize() {
                const patterns = {
                    ar: /[\u0600-\u06FF\w]+/g,
                    en: /\b\w+\b/g,
                    fr: /\b\w+\b/g,
                    es: /\b\w+\b/g,
                    de: /\b\w+\b/g
                };
                
                const pattern = patterns[this.language] || patterns.en;
                return (this.text.match(pattern) || []).map(t => t.toLowerCase());
            }

            splitSentences() {
                const patterns = {
                    ar: /[.!?ØŸ!]/g,
                    en: /[.!?]/g
                };
                
                const pattern = patterns[this.language] || patterns.en;
                return this.text.split(pattern).filter(s => s.trim().length > 0);
            }

            // ğŸ“Š Calculate Entropy (Shannon Entropy)
            calculateEntropy() {
                if (this.tokens.length === 0) return 0;
                
                const freq = {};
                this.tokens.forEach(token => {
                    freq[token] = (freq[token] || 0) + 1;
                });

                let entropy = 0;
                const total = this.tokens.length;
                
                Object.values(freq).forEach(count => {
                    const p = count / total;
                    entropy -= p * Math.log2(p);
                });

                return entropy;
            }

            // ğŸ“Š Calculate Perplexity (Text Predictability)
            calculatePerplexity() {
                const entropy = this.calculateEntropy();
                return Math.pow(2, entropy);
            }

            // ğŸ“Š Calculate Surprisal (Per-token analysis)
            calculateSurprisal() {
                const freq = {};
                this.tokens.forEach(token => {
                    freq[token] = (freq[token] || 0) + 1;
                });

                const total = this.tokens.length;
                const surprisal = this.tokens.map(token => {
                    const p = freq[token] / total;
                    return -Math.log2(p || 0.0001);
                });

                return {
                    mean: surprisal.reduce((a, b) => a + b, 0) / surprisal.length,
                    max: Math.max(...surprisal),
                    min: Math.min(...surprisal),
                    scores: surprisal
                };
            }

            // ğŸ“Š Calculate Burstiness (Repetition tendency)
            calculateBurstiness() {
                const freq = {};
                this.tokens.forEach(token => {
                    freq[token] = (freq[token] || 0) + 1;
                });

                const frequencies = Object.values(freq);
                const mean = frequencies.reduce((a, b) => a + b, 0) / frequencies.length;
                const variance = frequencies.reduce((sum, f) => sum + Math.pow(f - mean, 2), 0) / frequencies.length;
                const stdDev = Math.sqrt(variance);

                return stdDev / (mean + 0.001);
            }

            // ğŸ“Š Type-Token Ratio (Vocabulary Diversity)
            calculateTTR() {
                const uniqueTokens = new Set(this.tokens).size;
                return uniqueTokens / this.tokens.length;
            }

            // ğŸ“Š Flesch Kincaid Grade Level
            calculateReadability() {
                const words = this.tokens.length;
                const sentences = this.sentences.length;
                const syllables = this.countSyllables();

                if (words === 0 || sentences === 0) return 0;

                const grade = 0.39 * (words / sentences) + 11.8 * (syllables / words) - 15.59;
                return Math.max(0, grade);
            }

            countSyllables() {
                let count = 0;
                const vowels = this.language === 'ar' ? /[\u064E\u064F\u0650\u0627\u064E\u0648\u064A]/g : /[aeiou]/gi;
                
                this.tokens.forEach(word => {
                    const matches = word.match(vowels) || [];
                    count += matches.length || 1;
                });

                return count;
            }

            // ğŸ“Š Average Sentence Length
            getAverageSentenceLength() {
                if (this.sentences.length === 0) return 0;
                return this.tokens.length / this.sentences.length;
            }

            // ğŸ“Š Word Frequency Distribution
            getWordFrequency() {
                const freq = {};
                this.tokens.forEach(token => {
                    freq[token] = (freq[token] || 0) + 1;
                });

                return Object.entries(freq)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 20);
            }

            // ğŸ“Š Punctuation Analysis
            getPunctuationAnalysis() {
                const punctuation = this.text.match(/[.!?ØŒØ›:ØŸ]/g) || [];
                return {
                    count: punctuation.length,
                    ratio: punctuation.length / this.tokens.length,
                    variety: new Set(punctuation).size
                };
            }

            // ğŸ“Š Detect Language Automatically
            detectLanguage() {
                const arabicChars = (this.text.match(/[\u0600-\u06FF]/g) || []).length;
                const englishChars = (this.text.match(/[a-zA-Z]/g) || []).length;

                if (arabicChars > englishChars) return 'ar';
                if (englishChars > arabicChars) return 'en';
                return 'mixed';
            }
        }

        // ============================================
        // 2ï¸âƒ£ ENSEMBLE CLASSIFICATION MODEL
        // ============================================

        class AIDetectionEnsemble {
            constructor(analyzer, sensitivity = 'medium') {
                this.analyzer = analyzer;
                this.sensitivity = sensitivity;
                this.thresholds = {
                    low: { ai: 0.75, mixed: 0.50 },
                    medium: { ai: 0.65, mixed: 0.45 },
                    high: { ai: 0.55, mixed: 0.35 }
                };
            }

            // ğŸ§  Statistical Classifier
            statisticalModel() {
                const entropy = this.analyzer.calculateEntropy();
                const perplexity = this.analyzer.calculatePerplexity();
                const burstiness = this.analyzer.calculateBurstiness();
                const ttr = this.analyzer.calculateTTR();

                // AI Text Characteristics:
                // - Lower entropy (more predictable)
                // - Lower perplexity (formulaic)
                // - Higher burstiness (repetitive)
                // - Lower TTR (less vocabulary variety)

                const entropyScore = Math.min(entropy / 6, 1) * 0.3; // 0-1, higher = human
                const perplexityScore = Math.min(perplexity / 50, 1) * 0.3; // 0-1, higher = human
                const ttrScore = ttr * 0.25; // 0-1, higher = human
                const burstinessScore = (1 - Math.min(burstiness / 5, 1)) * 0.15; // 0-1, lower = human

                const humanScore = entropyScore + perplexityScore + ttrScore + burstinessScore;
                const aiScore = 1 - humanScore;

                return { humanScore, aiScore, entropy, perplexity, burstiness, ttr };
            }

            // ğŸ§  Linguistic Classifier
            linguisticModel() {
                const surprisal = this.analyzer.calculateSurprisal();
                const readability = this.analyzer.calculateReadability();
                const avgSentenceLength = this.analyzer.getAverageSentenceLength();
                const punctuation = this.analyzer.getPunctuationAnalysis();

                // AI Characteristics:
                // - Higher surprisal (more uniform)
                // - Lower punctuation variety
                // - More consistent sentence length

                const surprisalScore = Math.min(surprisal.mean / 15, 1) * 0.4; // Lower = AI
                const punctuationScore = (punctuation.variety / 6) * 0.3; // Lower = AI
                const sentenceConsistency = 1 - Math.min(Math.abs(avgSentenceLength - 12) / 20, 1) * 0.3;

                const aiScore = 1 - (surprisalScore + punctuationScore + sentenceConsistency) / 3;
                const humanScore = 1 - aiScore;

                return { humanScore, aiScore, surprisal, readability, avgSentenceLength, punctuation };
            }

            // ğŸ§  Stylometric Classifier
            stylometricModel() {
                const freq = this.analyzer.getWordFrequency();
                const wordLengths = this.analyzer.tokens.map(t => t.length);
                
                const avgWordLength = wordLengths.reduce((a, b) => a + b, 0) / wordLengths.length;
                const topWordRatio = freq.length > 0 ? freq[0][1] / this.analyzer.tokens.length : 0;

                // AI tends to repeat top words more often
                const repetitionScore = Math.min(topWordRatio * 3, 1);
                const wordLengthVariance = this.calculateVariance(wordLengths);
                
                const aiScore = (repetitionScore * 0.6 + (1 - Math.min(wordLengthVariance / 10, 1)) * 0.4);
                const humanScore = 1 - aiScore;

                return { humanScore, aiScore, avgWordLength, topWordRatio, wordLengthVariance };
            }

            // ğŸ§  Pattern Recognition Classifier
            patternModel() {
                const tokens = this.analyzer.tokens;
                const freq = {};
                tokens.forEach(t => freq[t] = (freq[t] || 0) + 1);

                // Check for AI Patterns
                const maxFreq = Math.max(...Object.values(freq));
                const highFreqWords = Object.values(freq).filter(f => f >= maxFreq * 0.5).length;

                // AI uses limited high-frequency words
                const patternScore = Math.min(highFreqWords / 20, 1);
                
                const aiScore = patternScore * 0.7;
                const humanScore = 1 - aiScore;

                return { humanScore, aiScore, highFreqWords, maxFreq };
            }

            // ğŸ¯ Ensemble Voting System
            predict() {
                const stat = this.statisticalModel();
                const ling = this.linguisticModel();
                const style = this.stylometricModel();
                const pattern = this.patternModel();

                // Weighted ensemble voting
                const weights = {
                    statistical: 0.35,
                    linguistic: 0.35,
                    stylometric: 0.20,
                    pattern: 0.10
                };

                const aiScore = (
                    stat.aiScore * weights.statistical +
                    ling.aiScore * weights.linguistic +
                    style.aiScore * weights.stylometric +
                    pattern.aiScore * weights.pattern
                );

                const humanScore = 1 - aiScore;

                const threshold = this.thresholds[this.sensitivity];
                let classification = 'MIXED';
                let confidence = Math.abs(aiScore - humanScore);

                if (aiScore > threshold.ai) {
                    classification = 'AI_GENERATED';
                    confidence = aiScore;
                } else if (humanScore > threshold.ai) {
                    classification = 'HUMAN_WRITTEN';
                    confidence = humanScore;
                }

                return {
                    classification,
                    aiScore: aiScore * 100,
                    humanScore: humanScore * 100,
                    confidence: confidence * 100,
                    models: { stat, ling, style, pattern }
                };
            }

            calculateVariance(arr) {
                const mean = arr.reduce((a, b) => a + b, 0) / arr.length;
                return Math.sqrt(arr.reduce((sum, x) => sum + Math.pow(x - mean, 2), 0) / arr.length);
            }

            // ğŸ”¥ Generate Risk Scores for Each Token
            generateTokenRiskScores() {
                const surprisal = this.analyzer.calculateSurprisal();
                const maxSurprisal = surprisal.max;
                const minSurprisal = surprisal.min;

                return this.analyzer.tokens.map((token, idx) => {
                    const score = (surprisal.scores[idx] - minSurprisal) / (maxSurprisal - minSurprisal);
                    return {
                        token,
                        risk: Math.max(0, Math.min(1, score)),
                        riskLevel: score > 0.7 ? 'high' : score > 0.4 ? 'medium' : 'low'
                    };
                });
            }
        }

        // ============================================
        // 3ï¸âƒ£ UI & INTERACTION LAYER
        // ============================================

        let currentAnalysis = null;
        let currentChart = null;

        async function analyzeText() {
            const text = document.getElementById('textInput').value;
            const selectedLanguage = document.getElementById('language').value;
            const sensitivity = document.getElementById('sensitivity').value;

            if (text.trim().split(/\s+/).length < 50) {
                alert(i18n[currentLang].minWords);
                return;
            }

            // Show loading state
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('noResults').innerHTML = `<div class="loading"><div class="spinner"></div><p>${i18n[currentLang].analyzing}</p></div>`;

            const startTime = performance.now();

            // Detect language if auto
            let language = selectedLanguage;
            if (selectedLanguage === 'auto') {
                const detector = new AdvancedTextAnalyzer(text);
                language = detector.detectLanguage();
            }

            // Process text
            const analyzer = new AdvancedTextAnalyzer(text, language);
            const ensemble = new AIDetectionEnsemble(analyzer, sensitivity);
            const prediction = ensemble.predict();
            const tokenRisks = ensemble.generateTokenRiskScores();

            const endTime = performance.now();
            const processingTime = (endTime - startTime).toFixed(2);

            currentAnalysis = {
                text,
                analyzer,
                ensemble,
                prediction,
                tokenRisks,
                processingTime,
                language
            };

            // Save to history
            historyManager.saveAnalysis(currentAnalysis);

            // Display results
            displayResults(prediction, analyzer, tokenRisks, processingTime);
        }

        function displayResults(prediction, analyzer, tokenRisks, processingTime) {
            const container = document.getElementById('resultsContainer');
            const noResults = document.getElementById('noResults');

            // Update main score circle
            const scoreCircle = document.getElementById('scoreCircle');
            const scoreValue = prediction.classification === 'AI_GENERATED' 
                ? prediction.aiScore 
                : prediction.humanScore;

            scoreCircle.textContent = scoreValue.toFixed(1) + '%';

            if (prediction.classification === 'HUMAN_WRITTEN') {
                scoreCircle.className = 'score-circle human';
                scoreCircle.textContent = prediction.humanScore.toFixed(1) + '%';
                document.getElementById('classification').className = 'classification human-text';
                document.getElementById('classification').textContent = i18n[currentLang].humanWritten;
            } else if (prediction.classification === 'AI_GENERATED') {
                scoreCircle.className = 'score-circle ai';
                scoreCircle.textContent = prediction.aiScore.toFixed(1) + '%';
                document.getElementById('classification').className = 'classification ai-text';
                document.getElementById('classification').textContent = i18n[currentLang].aiGenerated;
            } else {
                scoreCircle.className = 'score-circle mixed';
                scoreCircle.textContent = '50%';
                document.getElementById('classification').className = 'classification mixed-text';
                document.getElementById('classification').textContent = i18n[currentLang].mixedText;
            }

            // Update confidence
            const confClass = prediction.aiScore > 65 ? 'danger-text' : prediction.aiScore > 40 ? 'warning-text' : 'success-text';
            document.getElementById('confidenceFill').className = `confidence-fill ${confClass}`;
            document.getElementById('confidenceFill').style.width = prediction.confidence + '%';
            document.getElementById('confidenceFill').textContent = prediction.confidence.toFixed(1) + '%';

            // Update metrics
            document.getElementById('entropyValue').textContent = prediction.models.stat.entropy.toFixed(2);
            document.getElementById('perplexityValue').textContent = prediction.models.stat.perplexity.toFixed(2);
            document.getElementById('burstinessValue').textContent = prediction.models.stat.burstiness.toFixed(3);
            document.getElementById('ttrValue').textContent = prediction.models.stat.ttr.toFixed(3);

            // Update stats
            document.getElementById('wordCount').textContent = analyzer.tokens.length;
            document.getElementById('charCount').textContent = analyzer.text.length;
            document.getElementById('avgSentenceLength').textContent = analyzer.getAverageSentenceLength().toFixed(1);
            document.getElementById('processingTime').textContent = processingTime;

            document.getElementById('statsDisplay').style.display = 'block';

            // Create chart
            updateChart(prediction);

            // Update heatmap
            updateHeatmap(tokenRisks);

            // Update detailed metrics
            updateDetailedMetrics(prediction, analyzer);

            // Update insights
            updateInsights(prediction, analyzer);

            // Display results
            container.style.display = 'block';
            noResults.style.display = 'none';

            // Reset tabs
            switchTab('overview');
        }

        function updateChart(prediction) {
            const ctx = document.getElementById('resultsChart');
            if (ctx.parentElement.style.display !== 'none') {
                if (currentChart) currentChart.destroy();

                currentChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: [i18n[currentLang].humanScore, i18n[currentLang].aiScore],
                        datasets: [{
                            data: [prediction.humanScore, prediction.aiScore],
                            backgroundColor: ['#4CAF50', '#f44336'],
                            borderColor: ['#45a049', '#da190b'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { font: { size: 14 } }
                            }
                        }
                    }
                });
            }
        }

        function updateHeatmap(tokenRisks) {
            const heatmapDisplay = document.getElementById('heatmapDisplay');
            heatmapDisplay.innerHTML = '';

            tokenRisks.forEach((item, idx) => {
                const token = document.createElement('span');
                token.className = 'word-token heatmap-' + item.riskLevel;
                token.textContent = item.token;
                token.title = `Ø®Ø·Ø±: ${(item.risk * 100).toFixed(1)}%`;
                heatmapDisplay.appendChild(token);
            });
        }

        function updateDetailedMetrics(prediction, analyzer) {
            const container = document.getElementById('detailedMetrics');
            
            const metrics = [
                { label: 'Ù†Ø³Ø¨Ø© AI', value: prediction.aiScore.toFixed(2) + '%' },
                { label: 'Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø´Ø±ÙŠ', value: prediction.humanScore.toFixed(2) + '%' },
                { label: 'Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ù‚Ø©', value: prediction.confidence.toFixed(2) + '%' },
                { label: 'Entropy', value: prediction.models.stat.entropy.toFixed(3) },
                { label: 'Perplexity', value: prediction.models.stat.perplexity.toFixed(2) },
                { label: 'TTR', value: prediction.models.stat.ttr.toFixed(3) },
                { label: 'Ù…ØªÙˆØ³Ø· Ø·ÙˆÙ„ Ø§Ù„Ø¬Ù…Ù„Ø©', value: analyzer.getAverageSentenceLength().toFixed(1) },
                { label: 'Readability Grade', value: analyzer.calculateReadability().toFixed(1) },
                { label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ù…Ù„', value: analyzer.sentences.length },
                { label: 'Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„ÙØ±ÙŠØ¯Ø©', value: new Set(analyzer.tokens).size },
                { label: 'Ù…ØªÙˆØ³Ø· Ø·ÙˆÙ„ Ø§Ù„ÙƒÙ„Ù…Ø©', value: (analyzer.tokens.reduce((a,b) => a + b.length, 0) / analyzer.tokens.length).toFixed(1) },
                { label: 'Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ±Ù‚ÙŠÙ…', value: analyzer.getPunctuationAnalysis().count }
            ];

            container.innerHTML = metrics.map(m => `
                <div class="metric-box">
                    <div class="metric-label">${m.label}</div>
                    <div class="metric-value">${m.value}</div>
                </div>
            `).join('');
        }

        function updateInsights(prediction, analyzer) {
            const container = document.getElementById('insightsContainer');
            
            // Generate improvement suggestions
            const suggestionSystem = new ImprovementSuggestions(analyzer, prediction);
            suggestionSystem.generate();
            
            // Render suggestions
            container.innerHTML = '<h3 style="color: #16a085; margin-bottom: 15px;">' + 
                                  (currentLang === 'ar' ? 'ğŸ’¡ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ù„Ù„ØªØ­Ø³ÙŠÙ†' : 'ğŸ’¡ Improvement Suggestions') + 
                                  '</h3>' + suggestionSystem.renderHTML();
            
            // Keep original detailed insights as well
            container.innerHTML += '<h3 style="color: #16a085; margin: 30px 0 15px;">' + 
                                   (currentLang === 'ar' ? 'ğŸ” ØªØ­Ù„ÙŠÙ„ ØªÙØµÙŠÙ„ÙŠ' : 'ğŸ” Detailed Analysis') + 
                                   '</h3>';
            
            const insights = [];

            // Insight 1: Classification insight
            if (prediction.classification === 'AI_GENERATED') {
                insights.push({
                    title: 'ğŸ¤– Ù…Ø¤Ø´Ø±Ø§Øª Ù‚ÙˆÙŠØ© Ø¹Ù„Ù‰ AI',
                    text: 'Ø§Ù„Ù†Øµ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø®ØµØ§Ø¦Øµ Ù†Ù…Ø·ÙŠØ© Ù‚ÙˆÙŠØ© Ø¬Ø¯Ø§Ù‹ Ù…Ø«Ù„ Ø§Ù„Ø§Ù†ØªØ±ÙˆØ¨ÙŠØ§ Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø© ÙˆØ§Ù„ØªÙƒØ±Ø§Ø±ÙŠØ© Ø§Ù„Ø¹Ø§Ù„ÙŠØ©.'
                });
            } else if (prediction.classification === 'HUMAN_WRITTEN') {
                insights.push({
                    title: 'âœ… Ø®ØµØ§Ø¦Øµ Ø¨Ø´Ø±ÙŠØ© ÙˆØ§Ø¶Ø­Ø©',
                    text: 'Ø§Ù„Ù†Øµ ÙŠØ¸Ù‡Ø± ØªÙ†ÙˆØ¹Ø§Ù‹ Ø¹Ø§Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª ÙˆØ§Ù„Ø¬Ù…Ù„ Ù…Ø¹ Ø§Ù†ØªØ±ÙˆØ¨ÙŠØ§ Ø¹Ø§Ù„ÙŠØ©ØŒ Ù…Ù…Ø§ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ ÙƒØ§ØªØ¨ Ø¨Ø´Ø±ÙŠ.'
                });
            } else {
                insights.push({
                    title: 'âš ï¸ Ù†Øµ Ù…Ø®ØªÙ„Ø·',
                    text: 'ÙŠØ¨Ø¯Ùˆ Ø£Ù† Ø§Ù„Ù†Øµ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø¬Ø²Ø§Ø¡ Ø¨Ø´Ø±ÙŠØ© ÙˆØ£Ø¬Ø²Ø§Ø¡ Ø£Ø®Ø±Ù‰ Ù‚Ø¯ ØªÙƒÙˆÙ† Ù…Ø³Ø§Ø¹Ø¯Ø© Ù…Ù† AI.'
                });
            }

            // Insight 2: Vocabulary insight
            const ttr = prediction.models.stat.ttr;
            if (ttr < 0.3) {
                insights.push({
                    title: 'ğŸ“– Ù…ÙØ±Ø¯Ø§Øª Ù…Ø­Ø¯ÙˆØ¯Ø©',
                    text: 'Ø§Ù„Ù†Øµ ÙŠØ³ØªØ®Ø¯Ù… ØªÙ†ÙˆØ¹Ø§Ù‹ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù…Ù† Ø§Ù„Ù…ÙØ±Ø¯Ø§ØªØŒ ÙˆÙ‡ÙŠ Ø®Ø§ØµÙŠØ© Ø´Ø§Ø¦Ø¹Ø© ÙÙŠ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…ÙˆÙ„Ø¯Ø©.'
                });
            } else if (ttr > 0.6) {
                insights.push({
                    title: 'ğŸŒŸ Ù…ÙØ±Ø¯Ø§Øª Ù…ØªÙ†ÙˆØ¹Ø© Ø¬Ø¯Ø§Ù‹',
                    text: 'Ø§Ù„Ù†Øµ ÙŠØ³ØªØ®Ø¯Ù… ØªÙ†ÙˆØ¹Ø§Ù‹ Ø¹Ø§Ù„ÙŠØ§Ù‹ Ø¬Ø¯Ø§Ù‹ Ù…Ù† Ø§Ù„Ù…ÙØ±Ø¯Ø§ØªØŒ ÙˆÙ‡Ùˆ Ø£ÙƒØ«Ø± Ø´ÙŠÙˆØ¹Ø§Ù‹ ÙÙŠ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¨Ø´Ø±ÙŠØ©.'
                });
            }

            // Insight 3: Readability insight
            const grade = analyzer.calculateReadability();
            if (grade < 8) {
                insights.push({
                    title: 'ğŸ“ Ù†Øµ Ø¨Ø³ÙŠØ· ÙˆØ³Ù‡Ù„',
                    text: 'Ø§Ù„Ù†Øµ Ø³Ù‡Ù„ Ø§Ù„ÙÙ‡Ù… ÙˆØ§Ù„Ù‚Ø±Ø§Ø¡Ø©ØŒ Ù…Ù…Ø§ Ù‚Ø¯ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ù…Ø­ØªÙˆÙ‰ Ø¹Ø§Ù… Ø£Ùˆ Ù…Ø¹Ø§Ø¯ ØµÙŠØ§ØºØ©.'
                });
            } else if (grade > 14) {
                insights.push({
                    title: 'ğŸ“ Ù†Øµ Ù…ØªÙ‚Ø¯Ù… ÙˆØªØ®ØµØµÙŠ',
                    text: 'Ø§Ù„Ù†Øµ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ù„ØºÙˆÙŠ Ø¹Ø§Ù„ÙŠ ÙˆØªØ¹Ù‚ÙŠØ¯ ÙÙŠ Ø§Ù„Ø¬Ù…Ù„ØŒ ÙˆÙ‡Ùˆ Ù…Ø¤Ø´Ø± Ø¹Ù„Ù‰ ÙƒØ§ØªØ¨ Ù…Ø§Ù‡Ø±.'
                });
            }

            // Insight 4: Sentence consistency
            const avgSentenceLength = analyzer.getAverageSentenceLength();
            if (avgSentenceLength < 10) {
                insights.push({
                    title: 'â±ï¸ Ø¬Ù…Ù„ Ù‚ØµÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹',
                    text: 'Ù…ØªÙˆØ³Ø· Ø·ÙˆÙ„ Ø§Ù„Ø¬Ù…Ù„Ø© Ù…Ù†Ø®ÙØ¶ Ø¬Ø¯Ø§Ù‹ØŒ Ù…Ù…Ø§ Ù‚Ø¯ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ù†Ù…Ø· ÙƒØªØ§Ø¨Ø© Ù†Ù…Ø·ÙŠ.'
                });
            }

            // Insight 5: Burstiness insight
            const burstiness = prediction.models.stat.burstiness;
            if (burstiness > 2) {
                insights.push({
                    title: 'ğŸ”„ ØªÙƒØ±Ø§Ø±ÙŠØ© Ø¹Ø§Ù„ÙŠØ©',
                    text: 'Ø§Ù„Ù†Øµ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ØªÙƒØ±Ø§Ø± Ø¹Ø§Ù„ÙŠ Ù„Ù„ÙƒÙ„Ù…Ø§ØªØŒ ÙˆÙ‡ÙŠ Ø®Ø§ØµÙŠØ© Ø´Ø§Ø¦Ø¹Ø© ÙÙŠ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…ÙˆÙ„Ø¯Ø© Ø¨Ù€ AI.'
                });
            }

            container.innerHTML = insights.map(i => `
                <div class="insight">
                    <div class="insight-title">${i.title}</div>
                    <div class="insight-text">${i.text}</div>
                </div>
            `).join('');
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'overview' && currentChart) {
                setTimeout(() => currentChart.resize(), 100);
            }
        }

        function exportPDF() {
            if (!currentAnalysis) {
                alert(i18n[currentLang].noAnalysis || 'Please analyze text first');
                return;
            }

            try {
                // Show loading
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = currentLang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±...' : 'Exporting...';
                btn.disabled = true;

                // Make sure results are visible
                const element = document.getElementById('resultsContainer');
                if (element.style.display === 'none') {
                    element.style.display = 'block';
                }
                
                // Wait a moment for rendering
                setTimeout(() => {
                    const timestamp = new Date().toLocaleString();
                    const filename = `AI_Detection_Report_${Date.now()}.pdf`;
                    
                    const opt = {
                        margin: [10, 10, 10, 10],
                        filename: filename,
                        image: { 
                            type: 'jpeg', 
                            quality: 0.98 
                        },
                        html2canvas: { 
                            scale: 2,
                            useCORS: true,
                            logging: false,
                            letterRendering: true,
                            backgroundColor: '#ffffff'
                        },
                        jsPDF: { 
                            orientation: 'p', 
                            unit: 'mm', 
                            format: 'a4',
                            compress: true
                        },
                        pagebreak: { 
                            mode: ['avoid-all', 'css', 'legacy'],
                            avoid: '.metric-box'
                        }
                    };

                    html2pdf().set(opt).from(element).save().then(() => {
                        btn.textContent = originalText;
                        btn.disabled = false;
                    }).catch(err => {
                        console.error('PDF Export Error:', err);
                        alert(currentLang === 'ar' ? 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±' : 'Export error occurred');
                        btn.textContent = originalText;
                        btn.disabled = false;
                    });
                }, 100);
            } catch (error) {
                console.error('PDF generation failed:', error);
                alert(currentLang === 'ar' ? 'ÙØ´Ù„ ØªÙˆÙ„ÙŠØ¯ PDF' : 'PDF generation failed');
            }
        }

        function exportJSON() {
            if (!currentAnalysis) {
                alert(i18n[currentLang].noAnalysis || 'Please analyze text first');
                return;
            }

            try {
                const data = {
                    // Meta information
                    exportedAt: new Date().toISOString(),
                    appVersion: '2.0',
                    language: currentAnalysis.language,
                    
                    // Main results
                    results: {
                        classification: currentAnalysis.prediction.classification,
                        scores: {
                            ai: parseFloat(currentAnalysis.prediction.aiScore.toFixed(2)),
                            human: parseFloat(currentAnalysis.prediction.humanScore.toFixed(2)),
                            confidence: parseFloat(currentAnalysis.prediction.confidence.toFixed(2))
                        }
                    },
                    
                    // Text statistics
                    statistics: {
                        wordCount: currentAnalysis.analyzer.tokens.length,
                        charCount: currentAnalysis.analyzer.text.length,
                        sentenceCount: currentAnalysis.analyzer.sentences.length,
                        avgSentenceLength: currentAnalysis.analyzer.getAverageSentenceLength().toFixed(2),
                        uniqueWords: new Set(currentAnalysis.analyzer.tokens).size
                    },
                    
                    // Advanced metrics
                    metrics: {
                        entropy: parseFloat(currentAnalysis.prediction.models.stat.entropy.toFixed(3)),
                        perplexity: parseFloat(currentAnalysis.prediction.models.stat.perplexity.toFixed(2)),
                        burstiness: parseFloat(currentAnalysis.prediction.models.stat.burstiness.toFixed(3)),
                        ttr: parseFloat(currentAnalysis.prediction.models.stat.ttr.toFixed(3))
                    },
                    
                    // Model scores
                    modelScores: {
                        statistical: parseFloat(currentAnalysis.prediction.models.stat.aiScore.toFixed(3)),
                        linguistic: parseFloat(currentAnalysis.prediction.models.ling.aiScore.toFixed(3)),
                        stylometric: parseFloat(currentAnalysis.prediction.models.style.aiScore.toFixed(3)),
                        pattern: parseFloat(currentAnalysis.prediction.models.pattern.aiScore.toFixed(3))
                    },
                    
                    // Performance
                    performance: {
                        processingTime: currentAnalysis.processingTime + 'ms',
                        timestamp: new Date().getTime()
                    },
                    
                    // Text sample (first 500 chars)
                    textSample: currentAnalysis.text.substring(0, 500) + (currentAnalysis.text.length > 500 ? '...' : '')
                };

                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `AI_Detection_Report_${Date.now()}.json`;
                link.click();
                
                // Clean up
                setTimeout(() => URL.revokeObjectURL(url), 100);
            } catch (error) {
                console.error('JSON export failed:', error);
                alert(currentLang === 'ar' ? 'ÙØ´Ù„ ØªØµØ¯ÙŠØ± JSON' : 'JSON export failed');
            }
        }

        function clearAll() {
            document.getElementById('textInput').value = '';
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('noResults').style.display = 'block';
            document.getElementById('noResults').innerHTML = `<p style="font-size: 1.2em;">${i18n[currentLang].waiting}</p>`;
            document.getElementById('statsDisplay').style.display = 'none';
            currentAnalysis = null;
            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            console.log('âœ… AI Text Detection Studio - Enhanced Version');
            console.log('ğŸ§  Active Models: Statistical + Linguistic + Stylometric + Pattern');
            console.log('ğŸ¯ Target: 99%+ Accuracy with Advanced Multi-Layer Analysis');
            console.log('ğŸ“š History System: Enabled');
            
            // Apply default language (English)
            updateUIText();
            
            // Load history on startup
            historyManager.updateHistoryUI();
        });
    </script>
    <script src="batch-processing.js"></script>
</body>
</html>
