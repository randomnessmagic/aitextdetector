<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Text Detection Studio | ÿßÿ≥ÿ™ŸàÿØŸäŸà ŸÉÿ¥ŸÅ ÿßŸÑŸÜÿµŸàÿµ ÿßŸÑŸÖŸàŸÑÿØÿ© ÿ®ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä</title>

    <!-- SEO Meta Tags -->
    <meta name="description"
        content="Free AI Text Detector - Analyze text to detect AI-generated content. Advanced multi-layer analysis with high accuracy. Perfect for teachers, writers, and content creators.">
    <meta name="keywords"
        content="AI text detector, AI content detector, ChatGPT detector, AI detection, AI writing detector, plagiarism checker">
    <meta name="author" content="AITextDetector.free">
    <meta name="robots" content="index, follow">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="AI Text Detection Studio - Free AI Content Detector">
    <meta property="og:description"
        content="Free AI Text Detector - Analyze text to detect AI-generated content with high accuracy.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://aitextdetector.free">
    <meta property="og:locale" content="en_US">
    <meta property="og:locale:alternate" content="ar_SA">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="AI Text Detection Studio - Free AI Content Detector">
    <meta name="twitter:description"
        content="Free AI Text Detector with high accuracy. Perfect for teachers and content creators.">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üî¨</text></svg>">

    <!-- Copyright -->
    <meta name="copyright" content="¬© 2026 AITextDetector.free - All Rights Reserved">

    <!-- Scripts -->
    <script src="protection.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"
        onerror="window.Chart = null; console.warn('Chart.js failed to load');"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- PDF.js for PDF parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <!-- Mammoth.js for DOCX parsing -->
    <script src="https://unpkg.com/mammoth@1.6.0/mammoth.browser.min.js"></script>
    <style>
        :root {
            --primary: #3498db;
            --primary-dark: #2980b9;
            --success: #27ae60;
            --success-light: #2ecc71;
            --warning: #f39c12;
            --warning-light: #f1c40f;
            --danger: #e74c3c;
            --danger-light: #c0392b;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --lighter: #f8f9fa;
            --border: #bdc3c7;
            --text: #2c3e50;
            --text-light: #7f8c8d;
            --background: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text);
            height: 100%;
        }

        body {
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: slideDown 0.6s ease;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        textarea,
        input[type="text"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.95em;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        textarea {
            min-height: 200px;
            resize: vertical;
            font-family: 'Courier New', monospace;
        }

        textarea:focus,
        input:focus,
        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .btn {
            background: var(--primary);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .btn:hover {
            background: #1976D2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--warning);
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: #F57C00;
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .result-container {
            margin-top: 20px;
        }

        .score-display {
            text-align: center;
            margin: 20px 0;
        }

        .score-circle {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2.5em;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .human {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }

        .mixed {
            background: linear-gradient(135deg, #FF9800, #F57C00);
        }

        .ai {
            background: linear-gradient(135deg, #f44336, #da190b);
        }

        .classification {
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            margin: 15px 0;
            padding: 10px;
            border-radius: 8px;
        }

        .classification.human-text {
            background: rgba(76, 175, 80, 0.15);
            color: #2e7d32;
            border-left: 4px solid #4CAF50;
        }

        .classification.mixed-text {
            background: rgba(255, 152, 0, 0.15);
            color: #e65100;
            border-left: 4px solid #FF9800;
        }

        .classification.ai-text {
            background: rgba(244, 67, 54, 0.15);
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .metric-box {
            background: var(--light);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        .metric-label {
            font-size: 0.85em;
            color: #666;
            font-weight: 600;
            text-transform: uppercase;
        }

        .metric-value {
            font-size: 1.6em;
            font-weight: bold;
            color: var(--primary);
            margin-top: 5px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }

        .heatmap {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin: 20px 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .word-token {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            display: inline-block;
            transition: all 0.2s;
            cursor: pointer;
        }

        .word-token:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .heatmap-low {
            background: rgba(76, 175, 80, 0.6);
            color: white;
        }

        .heatmap-medium {
            background: rgba(255, 152, 0, 0.6);
            color: white;
        }

        .heatmap-high {
            background: rgba(244, 67, 54, 0.8);
            color: white;
        }

        .analysis-section {
            margin-top: 25px;
        }

        .insight {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
            animation: slideIn 0.4s ease;
        }

        .insight-title {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .insight-text {
            color: #666;
            font-size: 0.95em;
            line-height: 1.5;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }

        .tab {
            padding: 12px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .export-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .loading {
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid var(--light);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 20px;
            }

            .main-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            header h1 {
                font-size: 1.5em;
                margin-bottom: 8px;
            }

            header p {
                font-size: 0.95em;
            }

            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            textarea,
            input,
            select {
                font-size: 16px;
                /* Prevents zoom on iOS */
                padding: 10px;
            }

            textarea {
                min-height: 150px;
            }

            .lang-switcher {
                position: static;
                margin-bottom: 15px;
                display: block;
                width: 100%;
                text-align: center;
            }

            .tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                gap: 5px;
            }

            .tab {
                min-width: 100px;
                padding: 10px 15px;
                font-size: 0.9em;
                white-space: nowrap;
            }

            .score-circle {
                width: 120px;
                height: 120px;
                font-size: 2em;
            }

            .classification {
                font-size: 1.2em;
                padding: 8px 15px;
            }

            .export-buttons {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 250px;
            }

            .heatmap {
                font-size: 0.9em;
            }

            table {
                font-size: 0.9em;
            }

            th,
            td {
                padding: 8px 5px;
            }
        }

        @media (max-width: 480px) {
            header h1 {
                font-size: 1.3em;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .metric-value {
                font-size: 1.3em;
            }

            .score-circle {
                width: 100px;
                height: 100px;
                font-size: 1.8em;
            }
        }

        .confidence-bar {
            width: 100%;
            height: 30px;
            background: var(--light);
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .confidence-fill {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.85em;
            transition: width 0.6s ease;
        }

        .success-text {
            background: linear-gradient(90deg, #4CAF50, #45a049);
        }

        .warning-text {
            background: linear-gradient(90deg, #FF9800, #F57C00);
        }

        .danger-text {
            background: linear-gradient(90deg, #f44336, #da190b);
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <button class="lang-switcher" onclick="toggleLanguage()"
                style="position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 10px 20px; border-radius: 25px; cursor: pointer; font-weight: 600; backdrop-filter: blur(10px); transition: all 0.3s;">
                <span id="langButton">üåê ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</span>
            </button>
            <h1 id="mainTitle">üî¨ AI Text Detection Studio</h1>
            <p id="mainSubtitle">Advanced Multi-Layer Analysis - High Accuracy</p>
        </header>

        <div class="main-grid">
            <!-- Input Card -->
            <div class="card">
                <h2 id="inputCardTitle"><span data-en="üìù Text Input" data-ar="üìù ÿ•ÿØÿÆÿßŸÑ ÿßŸÑŸÜÿµ">üìù Text Input</span></h2>

                <div class="form-group">
                    <label for="language" id="languageLabel"><span data-en="üåê Select Language:"
                            data-ar="üåê ÿßÿÆÿ™ÿ± ÿßŸÑŸÑÿ∫ÿ©:">üåê Select Language:</span></label>
                    <select id="language">
                        <option value="auto" data-en="üîÑ Auto Detect" data-ar="üîÑ ÿßŸÉÿ™ÿ¥ÿßŸÅ ÿ™ŸÑŸÇÿßÿ¶Ÿä">üîÑ Auto Detect</option>
                        <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                        <option value="en">English</option>
                        <option value="fr">Fran√ßais</option>
                        <option value="es">Espa√±ol</option>
                        <option value="de">Deutsch</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="sensitivity" id="sensitivityLabel"><span data-en="‚öôÔ∏è Detection Sensitivity:"
                            data-ar="‚öôÔ∏è ÿ≠ÿ≥ÿßÿ≥Ÿäÿ© ÿßŸÑŸÉÿ¥ŸÅ:">‚öôÔ∏è Detection Sensitivity:</span></label>
                    <select id="sensitivity">
                        <option value="low" data-en="üü¢ Low (Fewer false positives)"
                            data-ar="üü¢ ŸÖŸÜÿÆŸÅÿ∂ÿ© (ÿ£ŸÇŸÑ ÿ•Ÿäÿ¨ÿßÿ®Ÿäÿßÿ™ ŸÉÿßÿ∞ÿ®ÿ©)">üü¢ Low (Fewer false positives)</option>
                        <option value="medium" selected data-en="üü° Medium (Balanced)" data-ar="üü° ŸÖÿ™Ÿàÿ≥ÿ∑ÿ© (ŸÖÿ™Ÿàÿßÿ≤ŸÜ)">üü°
                            Medium (Balanced)</option>
                        <option value="high" data-en="üî¥ High (Precise detection)" data-ar="üî¥ ÿπÿßŸÑŸäÿ© (ŸÉÿ¥ŸÅ ÿØŸÇŸäŸÇ)">üî¥ High
                            (Precise detection)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="textInput" id="textInputLabel"><span data-en="Text to analyze:"
                            data-ar="ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿ±ÿßÿØ ÿ™ÿ≠ŸÑŸäŸÑŸá:">Text to analyze:</span></label>
                    <textarea id="textInput" placeholder="Paste text here... (minimum 50 words)"></textarea>
                </div>

                <button class="btn" id="analyzeBtn" onclick="analyzeText()"><span data-en="üöÄ Analyze Text"
                        data-ar="üöÄ ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÜÿµ">üöÄ Analyze Text</span></button>
                <button class="btn btn-secondary" id="clearBtn" onclick="clearAll()"><span data-en="üîÑ Clear"
                        data-ar="üîÑ ŸÖÿ≥ÿ≠">üîÑ Clear</span></button>

                <div class="result-container" id="statsDisplay" style="display:none; margin-top: 20px;">
                    <div style="background: var(--light); padding: 15px; border-radius: 8px;">
                        <p><strong><span data-en="üìä Quick Statistics:" data-ar="üìä ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿ≥ÿ±Ÿäÿπÿ©:">üìä Quick
                                    Statistics:</span></strong></p>
                        <p><span data-en="Word count:" data-ar="ÿπÿØÿØ ÿßŸÑŸÉŸÑŸÖÿßÿ™:">Word count:</span> <strong
                                id="wordCount">0</strong></p>
                        <p><span data-en="Character count:" data-ar="ÿπÿØÿØ ÿßŸÑÿ£ÿ≠ÿ±ŸÅ:">Character count:</span> <strong
                                id="charCount">0</strong></p>
                        <p><span data-en="Avg sentence length:" data-ar="ŸÖÿ™Ÿàÿ≥ÿ∑ ÿ∑ŸàŸÑ ÿßŸÑÿ¨ŸÖŸÑÿ©:">Avg sentence length:</span>
                            <strong id="avgSentenceLength">0</strong>
                        </p>
                        <p><span data-en="Processing time:" data-ar="ŸàŸÇÿ™ ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ©:">Processing time:</span> <strong
                                id="processingTime">0</strong>ms</p>
                    </div>
                </div>
            </div>

            <!-- Results Card -->
            <div class="card">
                <h2 id="resultsCardTitle"><span data-en="üìä Results & Assessment" data-ar="üìä ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ŸàÿßŸÑÿ™ŸÇŸäŸäŸÖ">üìä
                        Results & Assessment</span></h2>
                <div id="resultsContainer" style="display: none;">
                    <div class="score-display">
                        <div id="scoreCircle" class="score-circle"></div>
                        <div id="classification" class="classification"></div>
                        <p style="color: #666; margin-top: 10px;" id="confidenceLabel"><span data-en="Confidence Score"
                                data-ar="ÿØÿ±ÿ¨ÿ© ÿßŸÑÿ´ŸÇÿ©">Confidence Score</span></p>
                        <div class="confidence-bar">
                            <div id="confidenceFill" class="confidence-fill" style="width: 0%">0%</div>
                        </div>
                    </div>

                    <div class="metrics-grid">
                        <div class="metric-box">
                            <div class="metric-label" id="entropyLabel"><span data-en="Entropy"
                                    data-ar="Entropy (ÿßŸÑŸÅŸàÿ∂Ÿâ)">Entropy</span></div>
                            <div class="metric-value" id="entropyValue">0.00</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label" id="perplexityLabel"><span data-en="Perplexity"
                                    data-ar="Perplexity (ÿßŸÑÿ™ŸÜÿ®ÿ§Ÿäÿ©)">Perplexity</span></div>
                            <div class="metric-value" id="perplexityValue">0.00</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label" id="burstinessLabel"><span data-en="Burstiness"
                                    data-ar="Burstiness (ÿßŸÑÿ™ŸÉÿ±ÿßÿ±)">Burstiness</span></div>
                            <div class="metric-value" id="burstinessValue">0.00</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label" id="ttrLabel"><span data-en="TTR (Vocabulary)"
                                    data-ar="TTR (ÿ™ŸÜŸàÿπ ÿßŸÑŸÖŸÅÿ±ÿØÿßÿ™)">TTR (Vocabulary)</span></div>
                            <div class="metric-value" id="ttrValue">0.00</div>
                        </div>
                    </div>

                    <div class="tabs">
                        <button class="tab active" onclick="switchTab('overview')"><span data-en="üìà Overview"
                                data-ar="üìà ŸÜÿ∏ÿ±ÿ© ÿπÿßŸÖÿ©">üìà Overview</span></button>
                        <button class="tab" onclick="switchTab('heatmap')"><span data-en="üî• Risk Heatmap"
                                data-ar="üî• ÿÆÿ±Ÿäÿ∑ÿ© ÿßŸÑŸÖÿÆÿßÿ∑ÿ±">üî• Risk Heatmap</span></button>
                        <button class="tab" onclick="switchTab('detailed')"><span data-en="üîç Details"
                                data-ar="üîç ÿ™ŸÅÿßÿµŸäŸÑ">üîç Details</span></button>
                        <button class="tab" onclick="switchTab('insights')"><span data-en="üí° Insights"
                                data-ar="üí° ÿ±ÿ§Ÿâ">üí° Insights</span></button>
                    </div>

                    <div id="overview" class="tab-content active">
                        <div class="chart-container">
                            <canvas id="resultsChart"></canvas>
                        </div>
                    </div>

                    <div id="heatmap" class="tab-content">
                        <p style="color: #666; margin-bottom: 10px;" id="heatmapLegend"><span
                                data-en="üî¥ High Risk | üü° Medium | üü¢ Low"
                                data-ar="üî¥ ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿπÿßŸÑŸäÿ© ÿßŸÑŸÖÿÆÿßÿ∑ÿ± | üü° ŸÖÿ™Ÿàÿ≥ÿ∑ÿ© | üü¢ ŸÖŸÜÿÆŸÅÿ∂ÿ©">üî¥ High Risk | üü° Medium | üü¢
                                Low</span>
                        </p>
                        <div class="heatmap" id="heatmapDisplay"></div>
                    </div>

                    <div id="detailed" class="tab-content">
                        <div id="detailedMetrics"
                            style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;"></div>
                    </div>

                    <div id="insights" class="tab-content">
                        <div id="insightsContainer"></div>
                    </div>

                    <div class="export-buttons">
                        <button class="btn btn-secondary" onclick="exportPDF()"><span data-en="üìÑ Export PDF"
                                data-ar="üìÑ ÿ™ÿµÿØŸäÿ± PDF">üìÑ Export PDF</span></button>
                        <button class="btn btn-secondary" onclick="exportJSON()"><span data-en="üìã Export JSON"
                                data-ar="üìã ÿ™ÿµÿØŸäÿ± JSON">üìã Export JSON</span></button>
                    </div>
                </div>

                <div id="noResults" style="text-align: center; color: #999; padding: 40px;">
                    <p style="font-size: 1.2em;"><span data-en="‚è≥ Waiting for text input..."
                            data-ar="‚è≥ ŸÅŸä ÿßŸÜÿ™ÿ∏ÿßÿ± ÿ•ÿØÿÆÿßŸÑ ÿßŸÑŸÜÿµ...">‚è≥ Waiting for text input...</span></p>

                </div>
            </div>
        </div>

        <!-- Batch Processing Card for Teachers -->
        <div class="card" style="margin-top: 20px; background: linear-gradient(135deg, #667eea, #764ba2);">
            <h2 style="border-bottom-color: #ffffff; color: #ffffff;">
                <span data-en="üéØ Batch Processing for Educators" data-ar="üéØ ŸÖÿπÿßŸÑÿ¨ÿ© ÿ¨ŸÖÿßÿπŸäÿ© ŸÑŸÑŸÖÿπŸÑŸÖŸäŸÜ">üéØ Batch
                    Processing for Educators</span>
            </h2>
            <p style="color: #ffffff; margin-bottom: 20px; opacity: 0.95;">
                <span
                    data-en="Upload multiple text files at once and get a comprehensive report. Perfect for grading assignments!"
                    data-ar="ÿßÿ±ŸÅÿπ ŸÖŸÑŸÅÿßÿ™ ŸÜÿµŸäÿ© ŸÖÿ™ÿπÿØÿØÿ© Ÿàÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ÿ™ŸÇÿ±Ÿäÿ± ÿ¥ÿßŸÖŸÑ. ŸÖÿ´ÿßŸÑŸä ŸÑÿ™ŸÇŸäŸäŸÖ ÿßŸÑŸàÿßÿ¨ÿ®ÿßÿ™!">Upload multiple text
                    files at once and get a comprehensive report. Perfect for grading assignments!</span>
            </p>

            <div
                style="background: white; padding: 20px; border-radius: 10px; border: 2px dashed #3498db; text-align: center; margin: 20px 0;">
                <div class="file-drop-zone" id="dropZone" style="padding: 40px; cursor: pointer;"
                    ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)"
                    onclick="document.getElementById('fileInput').click()">
                    <div style="font-size: 3em; margin-bottom: 15px;">üìÑ</div>
                    <h3 style="color: #3498db; margin-bottom: 10px;">
                        <span data-en="Drop files here or click to browse"
                            data-ar="ÿ£ÿ≥ŸÇÿ∑ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ŸáŸÜÿß ÿ£Ÿà ÿßÿ∂ÿ∫ÿ∑ ŸÑŸÑÿ™ÿµŸÅÿ≠">Drop files here or click to browse</span>
                    </h3>
                    <p style="color: #95a5a6;">
                        <span data-en="Supports: .txt, .docx, .pdf, .html | Max 50 files"
                            data-ar="ŸäÿØÿπŸÖ: .txt, .docx, .pdf, .html | ÿ≠ÿ™Ÿâ 50 ŸÖŸÑŸÅ">Supports: .txt, .docx, .pdf, .html |
                            Max 50 files</span>
                    </p>
                    <input type="file" id="fileInput" multiple accept=".txt,.docx,.pdf,.html" style="display: none;"
                        onchange="handleFiles(this.files)">
                </div>
            </div>

            <div id="filesList" style="margin: 20px 0; display: none;">
                <h3 style="color: #2c3e50; margin-bottom: 15px;">
                    <span data-en="Files to Process:" data-ar="ÿßŸÑŸÖŸÑŸÅÿßÿ™ ŸÑŸÑŸÖÿπÿßŸÑÿ¨ÿ©:">Files to Process:</span>
                    <span id="filesCount" style="color: #3498db;">0</span>
                </h3>
                <div id="filesListContainer"
                    style="max-height: 200px; overflow-y: auto; background: #ecf0f1; padding: 15px; border-radius: 8px;">
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn" onclick="processBatchFiles()" id="processBatchBtn"
                    style="flex: 1; background: #27ae60;" disabled>
                    <span data-en="üöÄ Process All Files" data-ar="üöÄ ŸÖÿπÿßŸÑÿ¨ÿ© ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÑŸÅÿßÿ™">üöÄ Process All Files</span>
                </button>
                <button class="btn btn-secondary" onclick="clearBatchFiles()" style="flex: 0.3;">
                    <span data-en="üóëÔ∏è Clear" data-ar="üóëÔ∏è ŸÖÿ≥ÿ≠">üóëÔ∏è Clear</span>
                </button>
            </div>

            <!-- Batch Results -->
            <div id="batchResults" style="display: none; margin-top: 30px;">
                <h3 style="color: #27ae60; margin-bottom: 20px; text-align: center;">
                    <span data-en="‚úÖ Processing Complete!" data-ar="‚úÖ ÿßŸÉÿ™ŸÖŸÑÿ™ ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ©!">‚úÖ Processing Complete!</span>
                </h3>

                <div id="batchSummary"
                    style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <!-- Summary will be inserted here -->
                </div>

                <div id="batchTable" style="background: white; padding: 20px; border-radius: 10px; overflow-x: auto;">
                    <!-- Table will be inserted here -->
                </div>

                <div
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 20px;">
                    <button class="btn" onclick="exportBatchPDF()" style="background: #e74c3c;">
                        <span data-en="üìÑ Export PDF Report" data-ar="üìÑ ÿ™ÿµÿØŸäÿ± ÿ™ŸÇÿ±Ÿäÿ± PDF">üìÑ Export PDF Report</span>
                    </button>
                    <button class="btn" onclick="exportBatchCSV()" style="background: #27ae60;">
                        <span data-en="üìà Export CSV" data-ar="üìà ÿ™ÿµÿØŸäÿ± CSV">üìà Export CSV</span>
                    </button>
                    <button class="btn" onclick="exportBatchExcel()" style="background: #16a085;">
                        <span data-en="üìä Export Excel" data-ar="üìä ÿ™ÿµÿØŸäÿ± Excel">üìä Export Excel</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- History Card -->
        <div class="card" style="margin-top: 20px;">
            <h2>
                <span data-en="üìö Analysis History" data-ar="üìö ÿ≥ÿ¨ŸÑ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿßÿ™">üìö Analysis History</span>
            </h2>
            <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                <p style="color: #666; margin: 0;">
                    <span data-en="Your last 50 analyses are saved locally" data-ar="ÿ¢ÿÆÿ± 50 ÿ™ÿ≠ŸÑŸäŸÑ ŸÖÿ≠ŸÅŸàÿ∏ÿ© ŸÖÿ≠ŸÑŸäÿßŸã">Your
                        last 50 analyses are saved locally</span>
                </p>
                <button class="btn btn-secondary"
                    onclick="if(confirm(i18n[currentLang].confirmClearHistory || 'Clear all history?')) historyManager.clearHistory()"
                    style="width: auto; padding: 8px 20px;">
                    <span data-en="üóëÔ∏è Clear History" data-ar="üóëÔ∏è ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ÿ¨ŸÑ">üóëÔ∏è Clear History</span>
                </button>
            </div>
            <div id="historyList" style="max-height: 500px; overflow-y: auto;">
                <p style="color: #999; text-align: center; padding: 20px;">No history yet</p>
            </div>
        </div>

        <!-- Support & Tools Card -->
        <div class="card" style="margin-top: 20px; background: linear-gradient(135deg, #667eea, #764ba2);">
            <h2 style="border-bottom-color: #ffffff; color: #ffffff;">
                <span data-en="üíù Support & Recommended Tools" data-ar="üíù ÿØÿπŸÖ Ÿàÿ£ÿØŸàÿßÿ™ ŸÖŸÇÿ™ÿ±ÿ≠ÿ©">üíù Support & Recommended
                    Tools</span>
            </h2>

            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 20px 0;">
                <!-- Support Section -->
                <div
                    style="background: white; padding: 20px; border-radius: 10px; text-align: center; border: 2px solid #28a745;">
                    <h3 style="color: #28a745; margin-bottom: 15px;">
                        <span data-en="‚òï Support This Project" data-ar="‚òï ÿßÿØÿπŸÖ Ÿáÿ∞ÿß ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ">‚òï Support This
                            Project</span>
                    </h3>
                    <p style="color: #666; margin-bottom: 15px; font-size: 0.95em;">
                        <span data-en="Help us keep this tool free and ad-free!"
                            data-ar="ÿ≥ÿßÿπÿØŸÜÿß ŸÅŸä ÿ•ÿ®ŸÇÿßÿ° Ÿáÿ∞Ÿá ÿßŸÑÿ£ÿØÿßÿ© ŸÖÿ¨ÿßŸÜŸäÿ© Ÿàÿ®ÿØŸàŸÜ ÿ•ÿπŸÑÿßŸÜÿßÿ™!">Help us keep this tool free and
                            ad-free!</span>
                    </p>
                    <a href="https://buymeacoffee.com/aitextdetector.free" target="_blank" rel="noopener"
                        style="display: inline-block; background: #FFDD00; color: #000; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: bold; transition: transform 0.2s;"
                        onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        üç™ <span data-en="Buy Me a Coffee" data-ar="ÿßÿ¥ÿ™ÿ±Ÿê ŸÑŸä ŸÇŸáŸàÿ©">Buy Me a Coffee</span>
                    </a>
                </div>

                <!-- Writing Tools -->
                <div style="background: white; padding: 20px; border-radius: 10px; border: 2px solid #3498db;">
                    <h3 style="color: #3498db; margin-bottom: 15px;">
                        <span data-en="‚ú® Improve Your Writing" data-ar="‚ú® ÿ≠ÿ≥ŸëŸÜ ŸÉÿ™ÿßÿ®ÿ™ŸÉ">‚ú® Improve Your Writing</span>
                    </h3>
                    <ul style="list-style: none; padding: 0; margin: 0;">
                        <li style="margin: 10px 0;">
                            <a href="https://www.grammarly.com/" target="_blank" rel="noopener"
                                style="display: flex; align-items: center; color: #2c3e50; text-decoration: none; padding: 8px; border-radius: 6px; transition: background 0.2s;"
                                onmouseover="this.style.background='#f8f9fa'"
                                onmouseout="this.style.background='transparent'">
                                üìù <strong style="margin-left: 10px;">Grammarly</strong> - Grammar & Spelling
                            </a>
                        </li>
                        <li style="margin: 10px 0;">
                            <a href="https://quillbot.com/" target="_blank" rel="noopener"
                                style="display: flex; align-items: center; color: #2c3e50; text-decoration: none; padding: 8px; border-radius: 6px; transition: background 0.2s;"
                                onmouseover="this.style.background='#f8f9fa'"
                                onmouseout="this.style.background='transparent'">
                                üîÑ <strong style="margin-left: 10px;">QuillBot</strong> - Paraphrasing Tool
                            </a>
                        </li>
                        <li style="margin: 10px 0;">
                            <a href="https://www.jasper.ai/" target="_blank" rel="noopener"
                                style="display: flex; align-items: center; color: #2c3e50; text-decoration: none; padding: 8px; border-radius: 6px; transition: background 0.2s;"
                                onmouseover="this.style.background='#f8f9fa'"
                                onmouseout="this.style.background='transparent'">
                                ü§ñ <strong style="margin-left: 10px;">Jasper AI</strong> - AI Writing Assistant
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <p style="text-align: center; color: #ffffff; font-size: 0.9em; margin-top: 15px; opacity: 0.9;">
                <span data-en="üíö Thank you for using our tool! Your support helps us improve."
                    data-ar="üíö ÿ¥ŸÉÿ±ÿßŸã ŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖŸÉ ŸÑÿ£ÿØÿßÿ™ŸÜÿß! ÿØÿπŸÖŸÉ Ÿäÿ≥ÿßÿπÿØŸÜÿß ÿπŸÑŸâ ÿßŸÑÿ™ÿ≠ÿ≥ŸäŸÜ.">üíö Thank you for using our tool!
                    Your support helps us improve.</span>
            </p>
        </div>
    </div>

    <script>
        // ============================================
        // üåê INTERNATIONALIZATION SYSTEM
        // ============================================

        let currentLang = 'en';

        const i18n = {
            en: {
                mainTitle: 'üî¨ AI Text Detection Studio',
                mainSubtitle: 'Advanced Multi-Layer Analysis - High Accuracy',
                langButton: 'üåê ÿßŸÑÿπÿ±ÿ®Ÿäÿ©',
                inputCardTitle: 'üìù Text Input',
                languageLabel: 'üåê Select Language:',
                autoDetect: 'üîÑ Auto Detect',
                sensitivityLabel: '‚öôÔ∏è Detection Sensitivity:',
                lowSensitivity: 'üü¢ Low (Fewer false positives)',
                mediumSensitivity: 'üü° Medium (Balanced)',
                highSensitivity: 'üî¥ High (Precise detection)',
                textInputLabel: 'Text to analyze:',
                textPlaceholder: 'Paste text here... (minimum 50 words)',
                analyzeBtn: 'üöÄ Analyze Text',
                clearBtn: 'üîÑ Clear',
                quickStats: 'üìä Quick Statistics:',
                wordCount: 'Word count:',
                charCount: 'Character count:',
                avgSentence: 'Average sentence length:',
                processingTime: 'Processing time:',
                resultsTitle: 'üìä Results & Assessment',
                confidenceLabel: 'Confidence Score',
                entropyLabel: 'Entropy (Chaos)',
                perplexityLabel: 'Perplexity (Predictability)',
                burstinessLabel: 'Burstiness (Repetition)',
                ttrLabel: 'TTR (Vocabulary Diversity)',
                overviewTab: 'üìà Overview',
                heatmapTab: 'üî• Risk Heatmap',
                detailedTab: 'üîç Details',
                insightsTab: 'üí° Insights',
                heatmapLegend: 'üî¥ High Risk Words | üü° Medium | üü¢ Low',
                exportPDF: 'üìÑ Export PDF',
                exportJSON: 'üìã Export JSON',
                waiting: '‚è≥ Waiting for text input...',
                analyzing: 'Advanced analysis in progress...',
                minWords: '‚ùå Please enter text with at least 50 words',
                humanWritten: '‚úÖ Human Written Text',
                aiGenerated: 'ü§ñ AI Generated Text',
                mixedText: '‚ö†Ô∏è Mixed Text (Human + AI)',
                humanScore: 'Human Score',
                aiScore: 'AI Score',
                noHistory: 'No history yet',
                reanalyzePrompt: 'Would you like to re-analyze this text?',
                confirmClearHistory: 'Are you sure you want to clear all history?',
                historyTitle: 'üìö Analysis History',
                historySaved: 'Your last 50 analyses are saved locally',
                clearHistoryBtn: 'üóëÔ∏è Clear History'
            },
            ar: {
                mainTitle: 'üî¨ ÿßÿ≥ÿ™ŸàÿØŸäŸà ŸÉÿ¥ŸÅ ÿßŸÑŸÜÿµŸàÿµ ÿßŸÑŸÖŸàŸÑÿØÿ© ÿ®ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä',
                mainSubtitle: 'ÿ™ÿ≠ŸÑŸäŸÑ ŸÖÿ™ŸÇÿØŸÖ ŸÖÿ™ÿπÿØÿØ ÿßŸÑÿ∑ÿ®ŸÇÿßÿ™ - ÿØŸÇÿ© ÿπÿßŸÑŸäÿ©',
                langButton: 'üåê English',
                inputCardTitle: 'üìù ÿ•ÿØÿÆÿßŸÑ ÿßŸÑŸÜÿµ',
                languageLabel: 'üåê ÿßÿÆÿ™ÿ± ÿßŸÑŸÑÿ∫ÿ©:',
                autoDetect: 'üîÑ ÿßŸÉÿ™ÿ¥ÿßŸÅ ÿ™ŸÑŸÇÿßÿ¶Ÿä',
                sensitivityLabel: '‚öôÔ∏è ÿ≠ÿ≥ÿßÿ≥Ÿäÿ© ÿßŸÑŸÉÿ¥ŸÅ:',
                lowSensitivity: 'üü¢ ŸÖŸÜÿÆŸÅÿ∂ÿ© (ÿ£ŸÇŸÑ ÿ•Ÿäÿ¨ÿßÿ®Ÿäÿßÿ™ ŸÉÿßÿ∞ÿ®ÿ©)',
                mediumSensitivity: 'üü° ŸÖÿ™Ÿàÿ≥ÿ∑ÿ© (ŸÖÿ™Ÿàÿßÿ≤ŸÜ)',
                highSensitivity: 'üî¥ ÿπÿßŸÑŸäÿ© (ŸÉÿ¥ŸÅ ÿØŸÇŸäŸÇ)',
                textInputLabel: 'ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿ±ÿßÿØ ÿ™ÿ≠ŸÑŸäŸÑŸá:',
                textPlaceholder: 'ÿßŸÑÿµŸÇ ÿßŸÑŸÜÿµ ŸáŸÜÿß... (ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ÿØŸÜŸâ 50 ŸÉŸÑŸÖÿ©)',
                analyzeBtn: 'üöÄ ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÜÿµ',
                clearBtn: 'üîÑ ŸÖÿ≥ÿ≠',
                quickStats: 'üìä ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿ≥ÿ±Ÿäÿπÿ©:',
                wordCount: 'ÿπÿØÿØ ÿßŸÑŸÉŸÑŸÖÿßÿ™:',
                charCount: 'ÿπÿØÿØ ÿßŸÑÿ£ÿ≠ÿ±ŸÅ:',
                avgSentence: 'ŸÖÿ™Ÿàÿ≥ÿ∑ ÿ∑ŸàŸÑ ÿßŸÑÿ¨ŸÖŸÑÿ©:',
                processingTime: 'ŸàŸÇÿ™ ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ©:',
                resultsTitle: 'üìä ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ŸàÿßŸÑÿ™ŸÇŸäŸäŸÖ',
                confidenceLabel: 'ÿØÿ±ÿ¨ÿ© ÿßŸÑÿ´ŸÇÿ©',
                entropyLabel: 'Entropy (ÿßŸÑŸÅŸàÿ∂Ÿâ)',
                perplexityLabel: 'Perplexity (ÿßŸÑÿ™ŸÜÿ®ÿ§Ÿäÿ©)',
                burstinessLabel: 'Burstiness (ÿßŸÑÿ™ŸÉÿ±ÿßÿ±)',
                ttrLabel: 'TTR (ÿ™ŸÜŸàÿπ ÿßŸÑŸÖŸÅÿ±ÿØÿßÿ™)',
                overviewTab: 'üìà ŸÜÿ∏ÿ±ÿ© ÿπÿßŸÖÿ©',
                heatmapTab: 'üî• ÿÆÿ±Ÿäÿ∑ÿ© ÿßŸÑŸÖÿÆÿßÿ∑ÿ±',
                detailedTab: 'üîç ÿ™ŸÅÿßÿµŸäŸÑ',
                insightsTab: 'üí° ÿ±ÿ§Ÿâ',
                heatmapLegend: 'üî¥ ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿπÿßŸÑŸäÿ© ÿßŸÑŸÖÿÆÿßÿ∑ÿ± | üü° ŸÖÿ™Ÿàÿ≥ÿ∑ÿ© | üü¢ ŸÖŸÜÿÆŸÅÿ∂ÿ©',
                exportPDF: 'üìÑ ÿ™ÿµÿØŸäÿ± PDF',
                exportJSON: 'üìã ÿ™ÿµÿØŸäÿ± JSON',
                waiting: '‚è≥ ŸÅŸä ÿßŸÜÿ™ÿ∏ÿßÿ± ÿ•ÿØÿÆÿßŸÑ ÿßŸÑŸÜÿµ...',
                analyzing: 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ...',
                minWords: '‚ùå ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ŸÜÿµ Ÿäÿ™ÿ∂ŸÖŸÜ 50 ŸÉŸÑŸÖÿ© ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ',
                humanWritten: '‚úÖ ŸÜÿµ ÿ®ÿ¥ÿ±Ÿä ÿßŸÑŸÉÿ™ÿßÿ®ÿ©',
                aiGenerated: 'ü§ñ ŸÜÿµ ŸÖŸàŸÑÿØ ŸÖŸÜ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä',
                mixedText: '‚ö†Ô∏è ŸÜÿµ ŸÖÿÆÿ™ŸÑÿ∑ (ÿ®ÿ¥ÿ±Ÿä + AI)',
                humanScore: 'ŸÜÿ≥ÿ®ÿ© ÿßŸÑŸÜÿµ ÿßŸÑÿ®ÿ¥ÿ±Ÿä',
                aiScore: 'ŸÜÿ≥ÿ®ÿ© AI',
                noHistory: 'ŸÑÿß ŸäŸàÿ¨ÿØ ÿ≥ÿ¨ŸÑ ÿ®ÿπÿØ',
                reanalyzePrompt: 'ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÑŸäŸÑ Ÿáÿ∞ÿß ÿßŸÑŸÜÿµÿü',
                confirmClearHistory: 'ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ŸÖÿ≥ÿ≠ ŸÉŸÑ ÿßŸÑÿ≥ÿ¨ŸÑÿü',
                historyTitle: 'üìö ÿ≥ÿ¨ŸÑ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿßÿ™',
                historySaved: 'ÿ¢ÿÆÿ± 50 ÿ™ÿ≠ŸÑŸäŸÑ ŸÖÿ≠ŸÅŸàÿ∏ÿ© ŸÖÿ≠ŸÑŸäÿßŸã',
                clearHistoryBtn: 'üóëÔ∏è ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ÿ¨ŸÑ'
            }
        };

        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'ar' : 'en';
            const dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            document.documentElement.setAttribute('lang', currentLang);
            document.documentElement.setAttribute('dir', dir);
            updateUIText();

            // Re-render results if they exist
            if (currentAnalysis && currentAnalysis.prediction) {
                displayResults(
                    currentAnalysis.prediction,
                    currentAnalysis.analyzer,
                    currentAnalysis.tokenRisks,
                    currentAnalysis.processingTime
                );
            }
        }

        function updateUIText() {
            const t = i18n[currentLang];

            // Update header
            document.getElementById('mainTitle').textContent = t.mainTitle;
            document.getElementById('mainSubtitle').textContent = t.mainSubtitle;
            document.getElementById('langButton').textContent = t.langButton;

            // Update ALL elements with data-en and data-ar attributes
            document.querySelectorAll('[data-en][data-ar]').forEach(el => {
                const text = currentLang === 'ar' ? el.getAttribute('data-ar') : el.getAttribute('data-en');
                if (text) {
                    el.textContent = text;
                }
            });

            // Update select options with data attributes
            document.querySelectorAll('option[data-en][data-ar]').forEach(option => {
                const text = currentLang === 'ar' ? option.getAttribute('data-ar') : option.getAttribute('data-en');
                if (text) {
                    option.textContent = text;
                }
            });

            // Update placeholder for textarea
            const textInput = document.getElementById('textInput');
            if (textInput) {
                textInput.placeholder = t.textPlaceholder;
            }

            // Update waiting message if visible
            const noResults = document.getElementById('noResults');
            if (noResults && noResults.style.display !== 'none') {
                const waitingSpan = noResults.querySelector('[data-en][data-ar]');
                if (waitingSpan) {
                    waitingSpan.textContent = currentLang === 'ar' ? waitingSpan.getAttribute('data-ar') : waitingSpan.getAttribute('data-en');
                }
            }

            // Re-render batch results if they exist
            if (typeof batchResults !== 'undefined' && batchResults.length > 0 && typeof displayBatchResults === 'function') {
                displayBatchResults();
            }

            // Re-render history to update classification labels
            if (typeof historyManager !== 'undefined' && historyManager.updateHistoryUI) {
                historyManager.updateHistoryUI();
            }
        }


        // ============================================
        // üìö HISTORY MANAGEMENT SYSTEM (LocalStorage)
        // ============================================

        class HistoryManager {
            constructor() {
                this.storageKey = 'ai_detector_history';
                this.maxItems = 50; // Maximum history items
            }

            saveAnalysis(data) {
                try {
                    const history = this.getHistory();
                    const item = {
                        id: Date.now(),
                        timestamp: new Date().toISOString(),
                        text: data.text.substring(0, 200) + (data.text.length > 200 ? '...' : ''),
                        fullText: data.text,
                        classification: data.prediction.classification,
                        aiScore: data.prediction.aiScore.toFixed(2),
                        humanScore: data.prediction.humanScore.toFixed(2),
                        confidence: data.prediction.confidence.toFixed(2),
                        language: data.language,
                        wordCount: data.analyzer.tokens.length,
                        metrics: {
                            entropy: data.prediction.models.stat.entropy.toFixed(2),
                            perplexity: data.prediction.models.stat.perplexity.toFixed(2),
                            burstiness: data.prediction.models.stat.burstiness.toFixed(3),
                            ttr: data.prediction.models.stat.ttr.toFixed(3)
                        }
                    };

                    history.unshift(item);

                    // Keep only max items
                    if (history.length > this.maxItems) {
                        history.splice(this.maxItems);
                    }

                    localStorage.setItem(this.storageKey, JSON.stringify(history));
                    this.updateHistoryUI();
                    return true;
                } catch (e) {
                    console.warn('Failed to save to history:', e);
                    return false;
                }
            }

            getHistory() {
                try {
                    const data = localStorage.getItem(this.storageKey);
                    return data ? JSON.parse(data) : [];
                } catch (e) {
                    return [];
                }
            }

            deleteItem(id) {
                try {
                    const history = this.getHistory();
                    const filtered = history.filter(item => item.id !== id);
                    localStorage.setItem(this.storageKey, JSON.stringify(filtered));
                    this.updateHistoryUI();
                    return true;
                } catch (e) {
                    return false;
                }
            }

            clearHistory() {
                try {
                    localStorage.removeItem(this.storageKey);
                    this.updateHistoryUI();
                    return true;
                } catch (e) {
                    return false;
                }
            }

            loadItem(id) {
                const history = this.getHistory();
                return history.find(item => item.id === id);
            }

            updateHistoryUI() {
                const history = this.getHistory();
                const container = document.getElementById('historyList');

                if (!container) return;

                if (history.length === 0) {
                    container.innerHTML = `<p style="color: #999; text-align: center; padding: 20px;">${i18n[currentLang].noHistory || 'No history yet'}</p>`;
                    return;
                }

                container.innerHTML = history.map(item => {
                    const date = new Date(item.timestamp);
                    const formattedDate = date.toLocaleString(currentLang === 'ar' ? 'ar-SA' : 'en-US');
                    const classColor = item.classification === 'HUMAN_WRITTEN' ? '#28a745' :
                        item.classification === 'AI_GENERATED' ? '#dc3545' : '#ffc107';

                    return `
                        <div class="history-item" data-id="${item.id}" style="background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid ${classColor}; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='translateX(-5px)'" onmouseout="this.style.transform='translateX(0)'">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div style="flex: 1;" onclick="loadFromHistory(${item.id})">
                                    <div style="font-weight: bold; color: #2c3e50; margin-bottom: 5px;">${item.text}</div>
                                    <div style="font-size: 0.85em; color: #666; margin-bottom: 8px;">${formattedDate}</div>
                                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                        <span style="background: ${classColor}; color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.8em;">
                                            ${item.classification === 'HUMAN_WRITTEN' ? (currentLang === 'ar' ? 'ÿ®ÿ¥ÿ±Ÿä' : 'Human') :
                            item.classification === 'AI_GENERATED' ? 'AI' : (currentLang === 'ar' ? 'ŸÖÿÆÿ™ŸÑÿ∑' : 'Mixed')}
                                        </span>
                                        <span style="background: #6c757d; color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.8em;">
                                            ${item.aiScore}% AI
                                        </span>
                                        <span style="background: #17a2b8; color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.8em;">
                                            ${item.wordCount} ${currentLang === 'ar' ? 'ŸÉŸÑŸÖÿ©' : 'words'}
                                        </span>
                                    </div>
                                </div>
                                <button onclick="event.stopPropagation(); historyManager.deleteItem(${item.id})" style="background: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; margin-left: 10px;">üóëÔ∏è</button>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        const historyManager = new HistoryManager();

        function loadFromHistory(id) {
            const item = historyManager.loadItem(id);
            if (item) {
                document.getElementById('textInput').value = item.fullText;
                // Optionally auto-analyze
                if (confirm(i18n[currentLang].reanalyzePrompt || 'Would you like to re-analyze this text?')) {
                    analyzeText();
                }
            }
        }

        // ============================================
        // üéØ IMPROVEMENT SUGGESTIONS SYSTEM
        // ============================================

        class ImprovementSuggestions {
            constructor(analyzer, prediction) {
                this.analyzer = analyzer;
                this.prediction = prediction;
                this.suggestions = [];
            }

            generate() {
                this.suggestions = [];
                const lang = currentLang;

                // 1. If AI score is high, suggest improvements
                if (this.prediction.aiScore > 60) {
                    this.addSuggestion(
                        lang === 'ar' ? 'üîÑ ÿ™ŸÜŸàŸäÿπ ÿ∑ŸàŸÑ ÿßŸÑÿ¨ŸÖŸÑ' : 'üîÑ Vary Sentence Length',
                        lang === 'ar' ? 'ÿ¨ŸÖŸÑŸÉ ŸÖŸÜÿ™ÿ∏ŸÖÿ© ÿ¨ÿØÿßŸã. ÿ≠ÿßŸàŸÑ ÿÆŸÑÿ∑ ÿ¨ŸÖŸÑ ŸÇÿµŸäÿ±ÿ© Ÿàÿ∑ŸàŸäŸÑÿ© ŸÑÿ•ÿ∂ŸÅÿßÿ° ÿ•ŸäŸÇÿßÿπ ÿ∑ÿ®ŸäÿπŸä.' :
                            'Your sentences are very uniform. Try mixing short and long sentences for natural rhythm.',
                        'high'
                    );
                }

                // 2. TTR suggestions
                const ttr = this.prediction.models.stat.ttr;
                if (ttr < 0.4) {
                    this.addSuggestion(
                        lang === 'ar' ? 'üìö ÿ™ŸÜŸàŸäÿπ ÿßŸÑŸÖŸÅÿ±ÿØÿßÿ™' : 'üìö Diversify Vocabulary',
                        lang === 'ar' ? 'ŸÑÿØŸäŸÉ ÿ™ŸÉÿ±ÿßÿ± ÿπÿßŸÑŸç ŸÑŸÜŸÅÿ≥ ÿßŸÑŸÉŸÑŸÖÿßÿ™. ÿßÿ≥ÿ™ÿÆÿØŸÖ ŸÖÿ±ÿßÿØŸÅÿßÿ™ Ÿàÿ™ÿπÿßÿ®Ÿäÿ± ŸÖÿÆÿ™ŸÑŸÅÿ©.' :
                            'You repeat the same words frequently. Use synonyms and varied expressions.',
                        'high'
                    );
                } else if (ttr > 0.7) {
                    this.addSuggestion(
                        lang === 'ar' ? '‚úÖ ŸÖŸÅÿ±ÿØÿßÿ™ ÿ∫ŸÜŸäÿ©' : '‚úÖ Rich Vocabulary',
                        lang === 'ar' ? 'ŸÖŸÖÿ™ÿßÿ≤! ÿ™ŸÜŸàÿπŸÉ ÿßŸÑŸÑÿ∫ŸàŸä ÿπÿßŸÑŸç ÿ¨ÿØÿßŸã ŸàŸäÿ¥Ÿäÿ± ŸÑŸÉÿ™ÿßÿ®ÿ© ÿ®ÿ¥ÿ±Ÿäÿ©.' :
                            'Excellent! Your vocabulary diversity is very high, indicating human writing.',
                        'positive'
                    );
                }

                // 3. Burstiness suggestions
                const burstiness = this.prediction.models.stat.burstiness;
                if (Math.abs(burstiness) < 0.1) {
                    this.addSuggestion(
                        lang === 'ar' ? 'üéØ ÿßÿÆÿ™ŸÑÿßŸÅ ÿßŸÑŸÜŸÖÿ∑' : 'üéØ Vary Writing Pattern',
                        lang === 'ar' ? 'ŸÜŸÖÿ∑ ŸÉÿ™ÿßÿ®ÿ™ŸÉ ŸÖŸÜÿ™ÿ∏ŸÖ ÿ¨ÿØÿßŸã. ÿ≠ÿßŸàŸÑ ÿßŸÑÿ™ÿπÿ®Ÿäÿ± ÿ®ÿ∑ÿ±ŸÇ ŸÖÿÆÿ™ŸÑŸÅÿ© ŸÑÿ•ÿ∂ŸÅÿßÿ° ÿ∑ÿßÿ®ÿπ ÿ®ÿ¥ÿ±Ÿä.' :
                            'Your writing pattern is very uniform. Try expressing ideas in different ways for human touch.',
                        'medium'
                    );
                }

                // 4. Entropy suggestions
                const entropy = this.prediction.models.stat.entropy;
                if (entropy < 4.0) {
                    this.addSuggestion(
                        lang === 'ar' ? 'üåà ÿ≤ŸäÿßÿØÿ© ÿßŸÑÿ™ŸÜŸàÿπ' : 'üåà Increase Variety',
                        lang === 'ar' ? 'ŸÜÿµŸÉ ŸÇÿßÿ®ŸÑ ŸÑŸÑÿ™ŸÜÿ®ÿ§ ÿ®ÿ¥ŸÉŸÑ ŸÉÿ®Ÿäÿ±. ÿ£ÿ∂ŸÅ ÿ£ŸÅŸÉÿßÿ±ÿßŸã ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÇÿπÿ© Ÿàÿ™ŸÅÿßÿµŸäŸÑ ÿÆÿßÿµÿ©.' :
                            'Your text is highly predictable. Add unexpected ideas and specific details.',
                        'high'
                    );
                }

                // 5. Sentence length suggestions
                const avgLength = this.analyzer.getAverageSentenceLength();
                if (avgLength > 15 && avgLength < 25) {
                    this.addSuggestion(
                        lang === 'ar' ? '‚ö†Ô∏è ÿ∑ŸàŸÑ ÿ¨ŸÖŸÑ ŸÖÿ´ÿßŸÑŸä ŸÑŸÑAI' : '‚ö†Ô∏è Typical AI Sentence Length',
                        lang === 'ar' ? 'ŸÖÿ™Ÿàÿ≥ÿ∑ ÿ∑ŸàŸÑ ÿ¨ŸÖŸÑŸÉ (' + avgLength.toFixed(1) + ') ŸÜŸÖŸàÿ∞ÿ¨Ÿä ŸÑŸÑAI. ÿ£ÿ∂ŸÅ ÿ¨ŸÖŸÑÿßŸã ŸÇÿµŸäÿ±ÿ© (<10) Ÿàÿ∑ŸàŸäŸÑÿ© (>30).' :
                            `Your average sentence length (${avgLength.toFixed(1)}) is typical for AI. Add short (<10) and long (>30) sentences.`,
                        'medium'
                    );
                }

                // 6. Add personal touch suggestion if AI score is high
                if (this.prediction.aiScore > 70) {
                    this.addSuggestion(
                        lang === 'ar' ? 'üë§ ÿ£ÿ∂ŸÅ ŸÑŸÖÿ≥ÿ© ÿ¥ÿÆÿµŸäÿ©' : 'üë§ Add Personal Touch',
                        lang === 'ar' ? 'ÿ£ÿ∂ŸÅ ÿ£ŸÖÿ´ŸÑÿ© ŸÖŸÜ ÿ™ÿ¨ÿ±ÿ®ÿ™ŸÉÿå ÿ¢ÿ±ÿßÿ° ÿ¥ÿÆÿµŸäÿ©ÿå ÿ£Ÿà ŸÇÿµÿµ ŸÖÿπŸäŸÜÿ©.' :
                            'Include examples from your experience, personal opinions, or specific stories.',
                        'high'
                    );
                }

                // 7. Positive reinforcement if score is human
                if (this.prediction.humanScore > 65) {
                    this.addSuggestion(
                        lang === 'ar' ? 'üéâ ŸÜÿµ ÿ®ÿ¥ÿ±Ÿä ŸÖŸÖÿ™ÿßÿ≤!' : 'üéâ Excellent Human Writing!',
                        lang === 'ar' ? 'ÿ±ÿßÿ¶ÿπ! ŸÜÿµŸÉ Ÿäÿ∏Ÿáÿ± ÿÆÿµÿßÿ¶ÿµ ŸÉÿ™ÿßÿ®ÿ© ÿ®ÿ¥ÿ±Ÿäÿ© Ÿàÿßÿ∂ÿ≠ÿ©.' :
                            'Great! Your text shows clear human writing characteristics.',
                        'positive'
                    );
                }

                return this.suggestions;
            }

            addSuggestion(title, text, priority) {
                this.suggestions.push({ title, text, priority });
            }

            renderHTML() {
                if (this.suggestions.length === 0) {
                    return '<p style="color: #999;">No suggestions available</p>';
                }

                return this.suggestions.map(s => {
                    const priorityColors = {
                        'high': '#dc3545',
                        'medium': '#ffc107',
                        'low': '#28a745',
                        'positive': '#17a2b8'
                    };

                    return `
                        <div class="insight" style="border-left-color: ${priorityColors[s.priority]};">
                            <div class="insight-title">${s.title}</div>
                            <div class="insight-text">${s.text}</div>
                        </div>
                    `;
                }).join('');
            }
        }

        // ============================================
        // 1Ô∏è‚É£ ADVANCED STATISTICAL ANALYSIS LAYER
        // ============================================

        class AdvancedTextAnalyzer {
            constructor(text, language = 'ar') {
                this.text = text.trim();
                this.language = language;
                this.tokens = this.tokenize();
                this.sentences = this.splitSentences();
            }

            tokenize() {
                const patterns = {
                    ar: /[\u0600-\u06FF\w]+/g,
                    en: /\b\w+\b/g,
                    fr: /\b\w+\b/g,
                    es: /\b\w+\b/g,
                    de: /\b\w+\b/g
                };

                const pattern = patterns[this.language] || patterns.en;
                return (this.text.match(pattern) || []).map(t => t.toLowerCase());
            }

            splitSentences() {
                const patterns = {
                    ar: /[.!?ÿü!]/g,
                    en: /[.!?]/g
                };

                const pattern = patterns[this.language] || patterns.en;
                return this.text.split(pattern).filter(s => s.trim().length > 0);
            }

            // üìä Calculate Entropy (Shannon Entropy)
            calculateEntropy() {
                if (this.tokens.length === 0) return 0;

                const freq = {};
                this.tokens.forEach(token => {
                    freq[token] = (freq[token] || 0) + 1;
                });

                let entropy = 0;
                const total = this.tokens.length;

                Object.values(freq).forEach(count => {
                    const p = count / total;
                    entropy -= p * Math.log2(p);
                });

                return entropy;
            }

            // üìä Calculate Perplexity (Text Predictability)
            calculatePerplexity() {
                const entropy = this.calculateEntropy();
                return Math.pow(2, entropy);
            }

            // üìä Calculate Surprisal (Per-token analysis)
            calculateSurprisal() {
                const freq = {};
                this.tokens.forEach(token => {
                    freq[token] = (freq[token] || 0) + 1;
                });

                const total = this.tokens.length;
                const surprisal = this.tokens.map(token => {
                    const p = freq[token] / total;
                    return -Math.log2(p || 0.0001);
                });

                return {
                    mean: surprisal.reduce((a, b) => a + b, 0) / surprisal.length,
                    max: Math.max(...surprisal),
                    min: Math.min(...surprisal),
                    scores: surprisal
                };
            }

            // üìä Calculate Burstiness (Repetition tendency)
            calculateBurstiness() {
                const freq = {};
                this.tokens.forEach(token => {
                    freq[token] = (freq[token] || 0) + 1;
                });

                const frequencies = Object.values(freq);
                const mean = frequencies.reduce((a, b) => a + b, 0) / frequencies.length;
                const variance = frequencies.reduce((sum, f) => sum + Math.pow(f - mean, 2), 0) / frequencies.length;
                const stdDev = Math.sqrt(variance);

                return stdDev / (mean + 0.001);
            }

            // üìä Type-Token Ratio (Vocabulary Diversity)
            calculateTTR() {
                const uniqueTokens = new Set(this.tokens).size;
                return uniqueTokens / this.tokens.length;
            }

            // üìä Flesch Kincaid Grade Level
            calculateReadability() {
                const words = this.tokens.length;
                const sentences = this.sentences.length;
                const syllables = this.countSyllables();

                if (words === 0 || sentences === 0) return 0;

                const grade = 0.39 * (words / sentences) + 11.8 * (syllables / words) - 15.59;
                return Math.max(0, grade);
            }

            countSyllables() {
                let count = 0;
                const vowels = this.language === 'ar' ? /[\u064E\u064F\u0650\u0627\u064E\u0648\u064A]/g : /[aeiou]/gi;

                this.tokens.forEach(word => {
                    const matches = word.match(vowels) || [];
                    count += matches.length || 1;
                });

                return count;
            }

            // üìä Average Sentence Length
            getAverageSentenceLength() {
                if (this.sentences.length === 0) return 0;
                return this.tokens.length / this.sentences.length;
            }

            // üìä Word Frequency Distribution
            getWordFrequency() {
                const freq = {};
                this.tokens.forEach(token => {
                    freq[token] = (freq[token] || 0) + 1;
                });

                return Object.entries(freq)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 20);
            }

            // üìä Punctuation Analysis
            getPunctuationAnalysis() {
                const punctuation = this.text.match(/[.!?ÿåÿõ:ÿü]/g) || [];
                return {
                    count: punctuation.length,
                    ratio: punctuation.length / this.tokens.length,
                    variety: new Set(punctuation).size
                };
            }

            // üìä Detect Language Automatically
            detectLanguage() {
                const arabicChars = (this.text.match(/[\u0600-\u06FF]/g) || []).length;
                const englishChars = (this.text.match(/[a-zA-Z]/g) || []).length;

                if (arabicChars > englishChars) return 'ar';
                if (englishChars > arabicChars) return 'en';
                return 'mixed';
            }
        }

        // ============================================
        // 2Ô∏è‚É£ ENSEMBLE CLASSIFICATION MODEL
        // ============================================

        class AIDetectionEnsemble {
            constructor(analyzer, sensitivity = 'medium') {
                this.analyzer = analyzer;
                this.sensitivity = sensitivity;
                this.thresholds = {
                    low: { ai: 0.75, mixed: 0.50 },
                    medium: { ai: 0.65, mixed: 0.45 },
                    high: { ai: 0.55, mixed: 0.35 }
                };
            }

            // üß† Statistical Classifier
            statisticalModel() {
                const entropy = this.analyzer.calculateEntropy();
                const perplexity = this.analyzer.calculatePerplexity();
                const burstiness = this.analyzer.calculateBurstiness();
                const ttr = this.analyzer.calculateTTR();

                // AI Text Characteristics:
                // - Lower entropy (more predictable)
                // - Lower perplexity (formulaic)
                // - Higher burstiness (repetitive)
                // - Lower TTR (less vocabulary variety)

                // Sensitivity affects scoring aggressiveness
                // High = more aggressive AI detection (stricter)
                // Low = more lenient (requires stronger evidence)
                const sensitivityMultiplier = this.sensitivity === 'high' ? 1.25 :
                    this.sensitivity === 'low' ? 0.75 : 1.0;

                const entropyScore = Math.min(entropy / 6, 1) * 0.3; // 0-1, higher = human
                const perplexityScore = Math.min(perplexity / 50, 1) * 0.3; // 0-1, higher = human
                const ttrScore = ttr * 0.25; // 0-1, higher = human
                const burstinessScore = (1 - Math.min(burstiness / 5, 1)) * 0.15; // 0-1, lower = human

                const humanScore = entropyScore + perplexityScore + ttrScore + burstinessScore;

                // Apply sensitivity to AI score (more aggressive detection in high mode)
                let aiScore = (1 - humanScore) * sensitivityMultiplier;
                aiScore = Math.min(Math.max(aiScore, 0), 1); // Clamp 0-1

                return { humanScore, aiScore, entropy, perplexity, burstiness, ttr };
            }

            // üß† Linguistic Classifier
            linguisticModel() {
                const surprisal = this.analyzer.calculateSurprisal();
                const readability = this.analyzer.calculateReadability();
                const avgSentenceLength = this.analyzer.getAverageSentenceLength();
                const punctuation = this.analyzer.getPunctuationAnalysis();

                // AI Characteristics:
                // - Higher surprisal (more uniform)
                // - Lower punctuation variety
                // - More consistent sentence length

                // Sensitivity affects how strictly we evaluate
                const sensitivityMultiplier = this.sensitivity === 'high' ? 1.25 :
                    this.sensitivity === 'low' ? 0.75 : 1.0;

                const surprisalScore = Math.min(surprisal.mean / 15, 1) * 0.4; // Lower = AI
                const punctuationScore = (punctuation.variety / 6) * 0.3; // Lower = AI
                const sentenceConsistency = 1 - Math.min(Math.abs(avgSentenceLength - 12) / 20, 1) * 0.3;

                let aiScore = (1 - (surprisalScore + punctuationScore + sentenceConsistency) / 3) * sensitivityMultiplier;
                aiScore = Math.min(Math.max(aiScore, 0), 1);
                const humanScore = 1 - aiScore;

                return { humanScore, aiScore, surprisal, readability, avgSentenceLength, punctuation };
            }

            // üß† Stylometric Classifier
            stylometricModel() {
                const freq = this.analyzer.getWordFrequency();
                const wordLengths = this.analyzer.tokens.map(t => t.length);

                const avgWordLength = wordLengths.reduce((a, b) => a + b, 0) / wordLengths.length;
                const topWordRatio = freq.length > 0 ? freq[0][1] / this.analyzer.tokens.length : 0;

                // AI tends to repeat top words more often
                const repetitionScore = Math.min(topWordRatio * 3, 1);
                const wordLengthVariance = this.calculateVariance(wordLengths);

                // Sensitivity affects scoring
                const sensitivityMultiplier = this.sensitivity === 'high' ? 1.2 :
                    this.sensitivity === 'low' ? 0.8 : 1.0;

                let aiScore = (repetitionScore * 0.6 + (1 - Math.min(wordLengthVariance / 10, 1)) * 0.4) * sensitivityMultiplier;
                aiScore = Math.min(Math.max(aiScore, 0), 1);
                const humanScore = 1 - aiScore;

                return { humanScore, aiScore, avgWordLength, topWordRatio, wordLengthVariance };
            }

            // üß† Pattern Recognition Classifier
            patternModel() {
                const tokens = this.analyzer.tokens;
                const freq = {};
                tokens.forEach(t => freq[t] = (freq[t] || 0) + 1);

                // Check for AI Patterns
                const maxFreq = Math.max(...Object.values(freq));
                const highFreqWords = Object.values(freq).filter(f => f >= maxFreq * 0.5).length;

                // AI uses limited high-frequency words
                const patternScore = Math.min(highFreqWords / 20, 1);

                // Sensitivity affects pattern detection
                const sensitivityMultiplier = this.sensitivity === 'high' ? 1.15 :
                    this.sensitivity === 'low' ? 0.85 : 1.0;

                let aiScore = patternScore * 0.7 * sensitivityMultiplier;
                aiScore = Math.min(Math.max(aiScore, 0), 1);
                const humanScore = 1 - aiScore;

                return { humanScore, aiScore, highFreqWords, maxFreq };
            }

            // üéØ Ensemble Voting System
            predict() {
                const stat = this.statisticalModel();
                const ling = this.linguisticModel();
                const style = this.stylometricModel();
                const pattern = this.patternModel();

                // Weighted ensemble voting - adjust weights based on sensitivity
                let weights;
                if (this.sensitivity === 'high') {
                    // High sensitivity: Trust statistical and linguistic more
                    weights = {
                        statistical: 0.40,
                        linguistic: 0.35,
                        stylometric: 0.15,
                        pattern: 0.10
                    };
                } else if (this.sensitivity === 'low') {
                    // Low sensitivity: More balanced, less aggressive
                    weights = {
                        statistical: 0.30,
                        linguistic: 0.30,
                        stylometric: 0.25,
                        pattern: 0.15
                    };
                } else {
                    // Medium (balanced)
                    weights = {
                        statistical: 0.35,
                        linguistic: 0.35,
                        stylometric: 0.20,
                        pattern: 0.10
                    };
                }

                const aiScore = (
                    stat.aiScore * weights.statistical +
                    ling.aiScore * weights.linguistic +
                    style.aiScore * weights.stylometric +
                    pattern.aiScore * weights.pattern
                );

                const humanScore = 1 - aiScore;

                const threshold = this.thresholds[this.sensitivity];
                let classification = 'MIXED';
                let confidence = Math.abs(aiScore - humanScore);

                if (aiScore > threshold.ai) {
                    classification = 'AI_GENERATED';
                    confidence = aiScore;
                } else if (humanScore > threshold.ai) {
                    classification = 'HUMAN_WRITTEN';
                    confidence = humanScore;
                }

                return {
                    classification,
                    aiScore: aiScore * 100,
                    humanScore: humanScore * 100,
                    confidence: confidence * 100,
                    models: { stat, ling, style, pattern }
                };
            }

            calculateVariance(arr) {
                const mean = arr.reduce((a, b) => a + b, 0) / arr.length;
                return Math.sqrt(arr.reduce((sum, x) => sum + Math.pow(x - mean, 2), 0) / arr.length);
            }

            // üî• Generate Risk Scores for Each Token
            generateTokenRiskScores() {
                const surprisal = this.analyzer.calculateSurprisal();
                const maxSurprisal = surprisal.max;
                const minSurprisal = surprisal.min;

                return this.analyzer.tokens.map((token, idx) => {
                    const score = (surprisal.scores[idx] - minSurprisal) / (maxSurprisal - minSurprisal);
                    return {
                        token,
                        risk: Math.max(0, Math.min(1, score)),
                        riskLevel: score > 0.7 ? 'high' : score > 0.4 ? 'medium' : 'low'
                    };
                });
            }
        }

        // ============================================
        // 3Ô∏è‚É£ UI & INTERACTION LAYER
        // ============================================

        let currentAnalysis = null;
        let currentChart = null;

        async function analyzeText() {
            const text = document.getElementById('textInput').value;
            const selectedLanguage = document.getElementById('language').value;
            const sensitivity = document.getElementById('sensitivity').value;

            if (text.trim().split(/\s+/).length < 50) {
                alert(i18n[currentLang].minWords);
                return;
            }

            // Show loading state
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('noResults').innerHTML = `<div class="loading"><div class="spinner"></div><p>${i18n[currentLang].analyzing}</p></div>`;

            const startTime = performance.now();

            // Detect language if auto
            let language = selectedLanguage;
            if (selectedLanguage === 'auto') {
                const detector = new AdvancedTextAnalyzer(text);
                language = detector.detectLanguage();
            }

            // Process text
            const analyzer = new AdvancedTextAnalyzer(text, language);
            const ensemble = new AIDetectionEnsemble(analyzer, sensitivity);
            const prediction = ensemble.predict();
            const tokenRisks = ensemble.generateTokenRiskScores();

            const endTime = performance.now();
            const processingTime = (endTime - startTime).toFixed(2);

            currentAnalysis = {
                text,
                analyzer,
                ensemble,
                prediction,
                tokenRisks,
                processingTime,
                language
            };

            // Save to history
            historyManager.saveAnalysis(currentAnalysis);

            // Display results
            displayResults(prediction, analyzer, tokenRisks, processingTime);
        }

        function displayResults(prediction, analyzer, tokenRisks, processingTime) {
            const container = document.getElementById('resultsContainer');
            const noResults = document.getElementById('noResults');

            // Update main score circle
            const scoreCircle = document.getElementById('scoreCircle');
            const scoreValue = prediction.classification === 'AI_GENERATED'
                ? prediction.aiScore
                : prediction.humanScore;

            scoreCircle.textContent = scoreValue.toFixed(1) + '%';

            if (prediction.classification === 'HUMAN_WRITTEN') {
                scoreCircle.className = 'score-circle human';
                scoreCircle.textContent = prediction.humanScore.toFixed(1) + '%';
                document.getElementById('classification').className = 'classification human-text';
                document.getElementById('classification').textContent = i18n[currentLang].humanWritten;
            } else if (prediction.classification === 'AI_GENERATED') {
                scoreCircle.className = 'score-circle ai';
                scoreCircle.textContent = prediction.aiScore.toFixed(1) + '%';
                document.getElementById('classification').className = 'classification ai-text';
                document.getElementById('classification').textContent = i18n[currentLang].aiGenerated;
            } else {
                scoreCircle.className = 'score-circle mixed';
                // Show actual AI score instead of hardcoded 50% for mixed results
                scoreCircle.textContent = prediction.aiScore.toFixed(1) + '%';
                document.getElementById('classification').className = 'classification mixed-text';
                document.getElementById('classification').textContent = i18n[currentLang].mixedText;
            }

            // Update confidence
            const confClass = prediction.aiScore > 65 ? 'danger-text' : prediction.aiScore > 40 ? 'warning-text' : 'success-text';
            document.getElementById('confidenceFill').className = `confidence-fill ${confClass}`;
            document.getElementById('confidenceFill').style.width = prediction.confidence + '%';
            document.getElementById('confidenceFill').textContent = prediction.confidence.toFixed(1) + '%';

            // Update metrics
            document.getElementById('entropyValue').textContent = prediction.models.stat.entropy.toFixed(2);
            document.getElementById('perplexityValue').textContent = prediction.models.stat.perplexity.toFixed(2);
            document.getElementById('burstinessValue').textContent = prediction.models.stat.burstiness.toFixed(3);
            document.getElementById('ttrValue').textContent = prediction.models.stat.ttr.toFixed(3);

            // Update stats
            document.getElementById('wordCount').textContent = analyzer.tokens.length;
            document.getElementById('charCount').textContent = analyzer.text.length;
            document.getElementById('avgSentenceLength').textContent = analyzer.getAverageSentenceLength().toFixed(1);
            document.getElementById('processingTime').textContent = processingTime;

            document.getElementById('statsDisplay').style.display = 'block';

            // Create chart
            updateChart(prediction);

            // Update heatmap
            updateHeatmap(tokenRisks);

            // Update detailed metrics
            updateDetailedMetrics(prediction, analyzer);

            // Update insights
            updateInsights(prediction, analyzer);

            // Display results
            container.style.display = 'block';
            noResults.style.display = 'none';

            // Reset tabs
            switchTab('overview');
        }

        function updateChart(prediction) {
            const ctx = document.getElementById('resultsChart');

            // Check if Chart.js is loaded
            if (typeof Chart === 'undefined' || !Chart) {
                ctx.parentElement.innerHTML = '<p style="text-align:center;color:#999;padding:20px;">Chart not available</p>';
                return;
            }

            if (ctx.parentElement.style.display !== 'none') {
                if (currentChart) currentChart.destroy();

                currentChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: [i18n[currentLang].humanScore, i18n[currentLang].aiScore],
                        datasets: [{
                            data: [prediction.humanScore, prediction.aiScore],
                            backgroundColor: ['#4CAF50', '#f44336'],
                            borderColor: ['#45a049', '#da190b'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { font: { size: 14 } }
                            }
                        }
                    }
                });
            }
        }

        function updateHeatmap(tokenRisks) {
            const heatmapDisplay = document.getElementById('heatmapDisplay');
            heatmapDisplay.innerHTML = '';

            tokenRisks.forEach((item, idx) => {
                const token = document.createElement('span');
                token.className = 'word-token heatmap-' + item.riskLevel;
                token.textContent = item.token;
                token.title = (currentLang === 'ar' ? 'ÿÆÿ∑ÿ±: ' : 'Risk: ') + (item.risk * 100).toFixed(1) + '%';
                heatmapDisplay.appendChild(token);
            });
        }

        function updateDetailedMetrics(prediction, analyzer) {
            const container = document.getElementById('detailedMetrics');
            const isAr = currentLang === 'ar';

            const metrics = [
                { label: isAr ? 'ŸÜÿ≥ÿ®ÿ© AI' : 'AI Score', value: prediction.aiScore.toFixed(2) + '%' },
                { label: isAr ? 'ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ®ÿ¥ÿ±Ÿä' : 'Human Score', value: prediction.humanScore.toFixed(2) + '%' },
                { label: isAr ? 'ÿØÿ±ÿ¨ÿ© ÿßŸÑÿ´ŸÇÿ©' : 'Confidence', value: prediction.confidence.toFixed(2) + '%' },
                { label: 'Entropy', value: prediction.models.stat.entropy.toFixed(3) },
                { label: 'Perplexity', value: prediction.models.stat.perplexity.toFixed(2) },
                { label: 'TTR', value: prediction.models.stat.ttr.toFixed(3) },
                { label: isAr ? 'ŸÖÿ™Ÿàÿ≥ÿ∑ ÿ∑ŸàŸÑ ÿßŸÑÿ¨ŸÖŸÑÿ©' : 'Avg Sentence Length', value: analyzer.getAverageSentenceLength().toFixed(1) },
                { label: isAr ? 'ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑŸÇÿ±ÿßÿ°ÿ©' : 'Readability Grade', value: analyzer.calculateReadability().toFixed(1) },
                { label: isAr ? 'ÿπÿØÿØ ÿßŸÑÿ¨ŸÖŸÑ' : 'Sentence Count', value: analyzer.sentences.length },
                { label: isAr ? 'ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑŸÅÿ±ŸäÿØÿ©' : 'Unique Words', value: new Set(analyzer.tokens).size },
                { label: isAr ? 'ŸÖÿ™Ÿàÿ≥ÿ∑ ÿ∑ŸàŸÑ ÿßŸÑŸÉŸÑŸÖÿ©' : 'Avg Word Length', value: (analyzer.tokens.reduce((a, b) => a + b.length, 0) / analyzer.tokens.length).toFixed(1) },
                { label: isAr ? 'ÿπŸÑÿßŸÖÿßÿ™ ÿßŸÑÿ™ÿ±ŸÇŸäŸÖ' : 'Punctuation', value: analyzer.getPunctuationAnalysis().count }
            ];

            container.innerHTML = metrics.map(m => `
                <div class="metric-box">
                    <div class="metric-label">${m.label}</div>
                    <div class="metric-value">${m.value}</div>
                </div>
            `).join('');
        }

        function updateInsights(prediction, analyzer) {
            const container = document.getElementById('insightsContainer');

            // Generate improvement suggestions
            const suggestionSystem = new ImprovementSuggestions(analyzer, prediction);
            suggestionSystem.generate();

            // Render suggestions
            container.innerHTML = '<h3 style="color: #16a085; margin-bottom: 15px;">' +
                (currentLang === 'ar' ? 'üí° ÿßŸÇÿ™ÿ±ÿßÿ≠ÿßÿ™ ŸÑŸÑÿ™ÿ≠ÿ≥ŸäŸÜ' : 'üí° Improvement Suggestions') +
                '</h3>' + suggestionSystem.renderHTML();

            // Keep original detailed insights as well
            container.innerHTML += '<h3 style="color: #16a085; margin: 30px 0 15px;">' +
                (currentLang === 'ar' ? 'üîç ÿ™ÿ≠ŸÑŸäŸÑ ÿ™ŸÅÿµŸäŸÑŸä' : 'üîç Detailed Analysis') +
                '</h3>';

            const insights = [];

            // Insight 1: Classification insight
            if (prediction.classification === 'AI_GENERATED') {
                insights.push({
                    title: currentLang === 'ar' ? 'ü§ñ ŸÖÿ§ÿ¥ÿ±ÿßÿ™ ŸÇŸàŸäÿ© ÿπŸÑŸâ AI' : 'ü§ñ Strong AI Indicators',
                    text: currentLang === 'ar' ? 'ÿßŸÑŸÜÿµ Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ÿÆÿµÿßÿ¶ÿµ ŸÜŸÖÿ∑Ÿäÿ© ŸÇŸàŸäÿ© ÿ¨ÿØÿßŸã ŸÖÿ´ŸÑ ÿßŸÑÿßŸÜÿ™ÿ±Ÿàÿ®Ÿäÿß ÿßŸÑŸÖŸÜÿÆŸÅÿ∂ÿ© ŸàÿßŸÑÿ™ŸÉÿ±ÿßÿ±Ÿäÿ© ÿßŸÑÿπÿßŸÑŸäÿ©.' :
                        'The text shows strong AI characteristics like low entropy and high repetitiveness.'
                });
            } else if (prediction.classification === 'HUMAN_WRITTEN') {
                insights.push({
                    title: currentLang === 'ar' ? '‚úÖ ÿÆÿµÿßÿ¶ÿµ ÿ®ÿ¥ÿ±Ÿäÿ© Ÿàÿßÿ∂ÿ≠ÿ©' : '‚úÖ Clear Human Characteristics',
                    text: currentLang === 'ar' ? 'ÿßŸÑŸÜÿµ Ÿäÿ∏Ÿáÿ± ÿ™ŸÜŸàÿπÿßŸã ÿπÿßŸÑŸäÿßŸã ŸÅŸä ÿßŸÑŸÖŸÅÿ±ÿØÿßÿ™ ŸàÿßŸÑÿ¨ŸÖŸÑ ŸÖÿπ ÿßŸÜÿ™ÿ±Ÿàÿ®Ÿäÿß ÿπÿßŸÑŸäÿ©ÿå ŸÖŸÖÿß Ÿäÿ¥Ÿäÿ± ÿ•ŸÑŸâ ŸÉÿßÿ™ÿ® ÿ®ÿ¥ÿ±Ÿä.' :
                        'The text shows high vocabulary diversity and sentence variety with high entropy, indicating a human writer.'
                });
            } else {
                insights.push({
                    title: currentLang === 'ar' ? '‚ö†Ô∏è ŸÜÿµ ŸÖÿÆÿ™ŸÑÿ∑' : '‚ö†Ô∏è Mixed Content',
                    text: currentLang === 'ar' ? 'Ÿäÿ®ÿØŸà ÿ£ŸÜ ÿßŸÑŸÜÿµ Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ÿ£ÿ¨ÿ≤ÿßÿ° ÿ®ÿ¥ÿ±Ÿäÿ© Ÿàÿ£ÿ¨ÿ≤ÿßÿ° ÿ£ÿÆÿ±Ÿâ ŸÇÿØ ÿ™ŸÉŸàŸÜ ŸÖÿ≥ÿßÿπÿØÿ© ŸÖŸÜ AI.' :
                        'The text appears to contain both human-written and AI-assisted sections.'
                });
            }

            // Insight 2: Vocabulary insight
            const ttr = prediction.models.stat.ttr;
            if (ttr < 0.3) {
                insights.push({
                    title: currentLang === 'ar' ? 'üìñ ŸÖŸÅÿ±ÿØÿßÿ™ ŸÖÿ≠ÿØŸàÿØÿ©' : 'üìñ Limited Vocabulary',
                    text: currentLang === 'ar' ? 'ÿßŸÑŸÜÿµ Ÿäÿ≥ÿ™ÿÆÿØŸÖ ÿ™ŸÜŸàÿπÿßŸã ŸÇŸÑŸäŸÑÿßŸã ŸÖŸÜ ÿßŸÑŸÖŸÅÿ±ÿØÿßÿ™ÿå ŸàŸáŸä ÿÆÿßÿµŸäÿ© ÿ¥ÿßÿ¶ÿπÿ© ŸÅŸä ÿßŸÑŸÜÿµŸàÿµ ÿßŸÑŸÖŸàŸÑÿØÿ©.' :
                        'The text uses limited vocabulary variety, a common characteristic of AI-generated text.'
                });
            } else if (ttr > 0.6) {
                insights.push({
                    title: currentLang === 'ar' ? 'üåü ŸÖŸÅÿ±ÿØÿßÿ™ ŸÖÿ™ŸÜŸàÿπÿ© ÿ¨ÿØÿßŸã' : 'üåü Highly Diverse Vocabulary',
                    text: currentLang === 'ar' ? 'ÿßŸÑŸÜÿµ Ÿäÿ≥ÿ™ÿÆÿØŸÖ ÿ™ŸÜŸàÿπÿßŸã ÿπÿßŸÑŸäÿßŸã ÿ¨ÿØÿßŸã ŸÖŸÜ ÿßŸÑŸÖŸÅÿ±ÿØÿßÿ™ÿå ŸàŸáŸà ÿ£ŸÉÿ´ÿ± ÿ¥ŸäŸàÿπÿßŸã ŸÅŸä ÿßŸÑŸÉÿ™ÿßÿ®ÿ© ÿßŸÑÿ®ÿ¥ÿ±Ÿäÿ©.' :
                        'The text uses highly diverse vocabulary, more common in human writing.'
                });
            }

            // Insight 3: Readability insight
            const grade = analyzer.calculateReadability();
            if (grade < 8) {
                insights.push({
                    title: currentLang === 'ar' ? 'üìù ŸÜÿµ ÿ®ÿ≥Ÿäÿ∑ Ÿàÿ≥ŸáŸÑ' : 'üìù Simple and Easy Text',
                    text: currentLang === 'ar' ? 'ÿßŸÑŸÜÿµ ÿ≥ŸáŸÑ ÿßŸÑŸÅŸáŸÖ ŸàÿßŸÑŸÇÿ±ÿßÿ°ÿ©ÿå ŸÖŸÖÿß ŸÇÿØ Ÿäÿ¥Ÿäÿ± ÿ•ŸÑŸâ ŸÖÿ≠ÿ™ŸàŸâ ÿπÿßŸÖ ÿ£Ÿà ŸÖÿπÿßÿØ ÿµŸäÿßÿ∫ÿ©.' :
                        'The text is easy to read and understand, which may indicate general or paraphrased content.'
                });
            } else if (grade > 14) {
                insights.push({
                    title: currentLang === 'ar' ? 'üéì ŸÜÿµ ŸÖÿ™ŸÇÿØŸÖ Ÿàÿ™ÿÆÿµÿµŸä' : 'üéì Advanced Specialized Text',
                    text: currentLang === 'ar' ? 'ÿßŸÑŸÜÿµ Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ŸÖÿ≥ÿ™ŸàŸâ ŸÑÿ∫ŸàŸä ÿπÿßŸÑŸä Ÿàÿ™ÿπŸÇŸäÿØ ŸÅŸä ÿßŸÑÿ¨ŸÖŸÑÿå ŸàŸáŸà ŸÖÿ§ÿ¥ÿ± ÿπŸÑŸâ ŸÉÿßÿ™ÿ® ŸÖÿßŸáÿ±.' :
                        'The text contains high-level language and complex sentences, indicating a skilled writer.'
                });
            }

            // Insight 4: Sentence consistency
            const avgSentenceLength = analyzer.getAverageSentenceLength();
            if (avgSentenceLength < 10) {
                insights.push({
                    title: currentLang === 'ar' ? '‚è±Ô∏è ÿ¨ŸÖŸÑ ŸÇÿµŸäÿ±ÿ© ÿ¨ÿØÿßŸã' : '‚è±Ô∏è Very Short Sentences',
                    text: currentLang === 'ar' ? 'ŸÖÿ™Ÿàÿ≥ÿ∑ ÿ∑ŸàŸÑ ÿßŸÑÿ¨ŸÖŸÑÿ© ŸÖŸÜÿÆŸÅÿ∂ ÿ¨ÿØÿßŸãÿå ŸÖŸÖÿß ŸÇÿØ Ÿäÿ¥Ÿäÿ± ÿ•ŸÑŸâ ŸÜŸÖÿ∑ ŸÉÿ™ÿßÿ®ÿ© ŸÜŸÖÿ∑Ÿä.' :
                        'Average sentence length is very low, which may indicate a formulaic writing pattern.'
                });
            }

            // Insight 5: Burstiness insight
            const burstiness = prediction.models.stat.burstiness;
            if (burstiness > 2) {
                insights.push({
                    title: currentLang === 'ar' ? 'üîÑ ÿ™ŸÉÿ±ÿßÿ±Ÿäÿ© ÿπÿßŸÑŸäÿ©' : 'üîÑ High Repetitiveness',
                    text: currentLang === 'ar' ? 'ÿßŸÑŸÜÿµ Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ÿ™ŸÉÿ±ÿßÿ± ÿπÿßŸÑŸä ŸÑŸÑŸÉŸÑŸÖÿßÿ™ÿå ŸàŸáŸä ÿÆÿßÿµŸäÿ© ÿ¥ÿßÿ¶ÿπÿ© ŸÅŸä ÿßŸÑŸÜÿµŸàÿµ ÿßŸÑŸÖŸàŸÑÿØÿ© ÿ®ŸÄ AI.' :
                        'The text contains high word repetition, a common characteristic of AI-generated text.'
                });
            }

            container.innerHTML = insights.map(i => `
                <div class="insight">
                    <div class="insight-title">${i.title}</div>
                    <div class="insight-text">${i.text}</div>
                </div>
            `).join('');
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // Find and activate the clicked tab
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                if (tab.textContent.toLowerCase().includes(tabName.substring(0, 4))) {
                    tab.classList.add('active');
                }
            });
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'overview' && currentChart) {
                setTimeout(() => currentChart.resize(), 100);
            }
        }

        function exportPDF() {
            if (!currentAnalysis) {
                alert(i18n[currentLang].noAnalysis || 'Please analyze text first');
                return;
            }

            try {
                // Show loading and preserve original content (including spans with data attributes)
                const btn = event.target.closest('button');
                const originalHTML = btn.innerHTML;
                const loadingText = currentLang === 'ar' ? 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿµÿØŸäÿ±...' : 'Exporting...';

                // Temporarily update only the text content if possible, or just replace innerHTML
                // To avoid breaking i18n on restore, we save originalHTML.
                btn.textContent = loadingText;
                btn.disabled = true;

                // Create professional PDF report content
                const isAr = currentLang === 'ar';
                const prediction = currentAnalysis.prediction;
                const analyzer = currentAnalysis.analyzer;

                const classLabel = prediction.classification === 'HUMAN_WRITTEN' ?
                    (isAr ? '‚úÖ ŸÜÿµ ÿ®ÿ¥ÿ±Ÿä' : '‚úÖ Human Written') :
                    prediction.classification === 'AI_GENERATED' ?
                        (isAr ? 'ü§ñ ŸÜÿµ ŸÖŸàŸÑÿØ ÿ®ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä' : 'ü§ñ AI Generated') :
                        (isAr ? '‚ö†Ô∏è ŸÜÿµ ŸÖÿÆÿ™ŸÑÿ∑' : '‚ö†Ô∏è Mixed Content');

                const classColor = prediction.classification === 'HUMAN_WRITTEN' ? '#27ae60' :
                    prediction.classification === 'AI_GENERATED' ? '#e74c3c' : '#f39c12';

                // Generate Insights HTML for PDF
                const suggestions = new ImprovementSuggestions(analyzer, prediction, currentLang);
                const insightsList = suggestions.generate();

                const insightsHTML = insightsList.length > 0 ? `
                    <div style="margin: 30px 0;">
                        <h2 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                            üí° ${isAr ? 'ÿ±ÿ§Ÿâ Ÿàÿ™ŸàÿµŸäÿßÿ™' : 'Insights & Recommendations'}
                        </h2>
                        ${insightsList.map(insight => `
                            <div style="margin-bottom: 15px; padding: 10px; background: #eef2f7; border-radius: 5px; border-${isAr ? 'right' : 'left'}: 4px solid #3498db;">
                                <div style="font-weight: bold; color: #2c3e50; margin-bottom: 5px;">${insight.title}</div>
                                <div style="color: #555; font-size: 13px;">${insight.text}</div>
                            </div>
                        `).join('')}
                    </div>
                ` : '';

                // Create styled report container
                const reportContainer = document.createElement('div');
                reportContainer.id = 'pdf-report-temp';
                reportContainer.style.cssText = `
                    background: white;
                    padding: 30px;
                    font-family: 'Segoe UI', Tahoma, sans-serif;
                    direction: ${isAr ? 'rtl' : 'ltr'};
                    max-width: 800px;
                    margin: 0 auto;
                    color: #333;
                `;

                reportContainer.innerHTML = `
                    <!-- Header -->
                    <div style="text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 3px solid #3498db;">
                        <h1 style="color: #3498db; margin: 0; font-size: 28px;">üî¨ ${isAr ? 'ÿ™ŸÇÿ±Ÿäÿ± ŸÉÿ¥ŸÅ ÿßŸÑŸÜÿµŸàÿµ ÿßŸÑŸÖŸàŸÑÿØÿ© ÿ®ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä' : 'AI Text Detection Report'}</h1>
                        <p style="color: #666; margin: 10px 0 0 0; font-size: 14px;">aitextdetector.free</p>
                        <p style="color: #999; margin: 5px 0 0 0; font-size: 12px;">${new Date().toLocaleString(isAr ? 'ar-SA' : 'en-US')}</p>
                    </div>
                    
                    <!-- Main Result -->
                    <div style="text-align: center; margin: 20px 0; padding: 20px; background: ${classColor}15; border-radius: 10px; border: 2px solid ${classColor};">
                        <div style="font-size: 42px; font-weight: bold; color: ${classColor}; margin-bottom: 8px;">
                            ${prediction.classification === 'HUMAN_WRITTEN' ? prediction.humanScore.toFixed(1) : prediction.aiScore.toFixed(1)}%
                        </div>
                        <div style="font-size: 20px; font-weight: bold; color: ${classColor}; margin-bottom: 8px;">
                            ${classLabel}
                        </div>
                        <p style="color: #666; margin: 0; font-size: 13px;">
                            ${isAr ? 'ÿØÿ±ÿ¨ÿ© ÿßŸÑÿ´ŸÇÿ©' : 'Confidence'}: ${prediction.confidence.toFixed(1)}%
                        </p>
                    </div>
                    
                    <!-- Score Comparison Table -->
                    <table style="width: 100%; margin: 20px 0; border-collapse: collapse;">
                        <tr>
                            <td style="width: 48%; padding: 15px; background: #27ae6015; border-radius: 8px; text-align: center;">
                                <div style="font-size: 28px; font-weight: bold; color: #27ae60;">${prediction.humanScore.toFixed(1)}%</div>
                                <div style="color: #666; margin-top: 5px; font-size: 13px;">${isAr ? 'ŸÜÿ≥ÿ®ÿ© ÿßŸÑŸÜÿµ ÿßŸÑÿ®ÿ¥ÿ±Ÿä' : 'Human Score'}</div>
                            </td>
                            <td style="width: 4%;"></td>
                            <td style="width: 48%; padding: 15px; background: #e74c3c15; border-radius: 8px; text-align: center;">
                                <div style="font-size: 28px; font-weight: bold; color: #e74c3c;">${prediction.aiScore.toFixed(1)}%</div>
                                <div style="color: #666; margin-top: 5px; font-size: 13px;">${isAr ? 'ŸÜÿ≥ÿ®ÿ© AI' : 'AI Score'}</div>
                            </td>
                        </tr>
                    </table>
                    
                    <!-- Text Statistics -->
                    <div style="margin: 30px 0;">
                        <h2 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                            üìä ${isAr ? 'ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÜÿµ' : 'Text Statistics'}
                        </h2>
                        <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                            <tr>
                                <td style="padding: 10px; border: 1px solid #eee; background: #f8f9fa;">${isAr ? 'ÿπÿØÿØ ÿßŸÑŸÉŸÑŸÖÿßÿ™' : 'Word Count'}</td>
                                <td style="padding: 10px; border: 1px solid #eee; font-weight: bold;">${analyzer.tokens.length}</td>
                                <td style="padding: 10px; border: 1px solid #eee; background: #f8f9fa;">${isAr ? 'ÿπÿØÿØ ÿßŸÑÿ£ÿ≠ÿ±ŸÅ' : 'Character Count'}</td>
                                <td style="padding: 10px; border: 1px solid #eee; font-weight: bold;">${analyzer.text.length}</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border: 1px solid #eee; background: #f8f9fa;">${isAr ? 'ÿπÿØÿØ ÿßŸÑÿ¨ŸÖŸÑ' : 'Sentence Count'}</td>
                                <td style="padding: 10px; border: 1px solid #eee; font-weight: bold;">${analyzer.sentences.length}</td>
                                <td style="padding: 10px; border: 1px solid #eee; background: #f8f9fa;">${isAr ? 'ŸÖÿ™Ÿàÿ≥ÿ∑ ÿ∑ŸàŸÑ ÿßŸÑÿ¨ŸÖŸÑÿ©' : 'Avg Sentence Length'}</td>
                                <td style="padding: 10px; border: 1px solid #eee; font-weight: bold;">${analyzer.getAverageSentenceLength().toFixed(1)}</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- Advanced Metrics -->
                    <div style="margin: 30px 0;">
                        <h2 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                            üìà ${isAr ? 'ÿßŸÑŸÖŸÇÿßŸäŸäÿ≥ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ©' : 'Advanced Metrics'}
                        </h2>
                        <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                            <tr>
                                <td style="width: 48%; padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #3498db;">
                                    <div style="color: #666; font-size: 11px; text-transform: uppercase;">Entropy</div>
                                    <div style="font-size: 20px; font-weight: bold; color: #3498db;">${prediction.models.stat.entropy.toFixed(3)}</div>
                                </td>
                                <td style="width: 4%;"></td>
                                <td style="width: 48%; padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #9b59b6;">
                                    <div style="color: #666; font-size: 11px; text-transform: uppercase;">Perplexity</div>
                                    <div style="font-size: 20px; font-weight: bold; color: #9b59b6;">${prediction.models.stat.perplexity.toFixed(2)}</div>
                                </td>
                            </tr>
                            <tr><td colspan="3" style="height: 10px;"></td></tr>
                            <tr>
                                <td style="padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #e67e22;">
                                    <div style="color: #666; font-size: 11px; text-transform: uppercase;">Burstiness</div>
                                    <div style="font-size: 20px; font-weight: bold; color: #e67e22;">${prediction.models.stat.burstiness.toFixed(3)}</div>
                                </td>
                                <td style="width: 4%;"></td>
                                <td style="padding: 12px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #1abc9c;">
                                    <div style="color: #666; font-size: 11px; text-transform: uppercase;">TTR (Vocabulary)</div>
                                    <div style="font-size: 20px; font-weight: bold; color: #1abc9c;">${prediction.models.stat.ttr.toFixed(3)}</div>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <!-- Insights & Recommendations -->
                    ${insightsHTML}
                    
                    <!-- Text Preview -->
                    <div style="margin: 30px 0;">
                        <h2 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                            üìù ${isAr ? 'ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑŸÜÿµ' : 'Text Preview'}
                        </h2>
                        <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; margin-top: 15px; font-size: 13px; line-height: 1.6; color: #555; max-height: 150px; overflow: hidden;">
                            ${currentAnalysis.text.substring(0, 500)}${currentAnalysis.text.length > 500 ? '...' : ''}
                        </div>
                    </div>
                    
                    <!-- Footer -->
                    <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 2px solid #eee;">
                        <p style="color: #999; font-size: 12px; margin: 0;">
                            ¬© 2026 aitextdetector.free - ${isAr ? 'ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©' : 'All Rights Reserved'}
                        </p>
                        <p style="color: #bbb; font-size: 11px; margin-top: 5px;">
                            ${isAr ? 'ŸàŸÇÿ™ ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ©' : 'Processing time'}: ${currentAnalysis.processingTime}ms
                        </p>
                    </div>
                `;

                document.body.appendChild(reportContainer);

                // Generate PDF
                // Increased timeout to ensure rendering is complete
                setTimeout(() => {
                    const filename = `AI_Detection_Report_${Date.now()}`;

                    const opt = {
                        margin: [10, 10, 10, 10],
                        filename: filename + '.pdf', // Ensure .pdf extension
                        image: { type: 'jpeg', quality: 0.98 },
                        html2canvas: {
                            scale: 2,
                            useCORS: true,
                            logging: false,
                            backgroundColor: '#ffffff',
                            windowWidth: 800 // Ensure consistent width
                        },
                        jsPDF: { orientation: 'p', unit: 'mm', format: 'a4', compress: true },
                        pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
                    };

                    // Use outputPdf with save to ensure proper PDF generation
                    html2pdf().set(opt).from(reportContainer).outputPdf('blob').then((pdfBlob) => {
                        // Create download link with proper MIME type (no double wrapping)
                        const url = URL.createObjectURL(pdfBlob);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = filename + '.pdf';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);

                        // Delay URL revocation to ensure download completes
                        setTimeout(() => URL.revokeObjectURL(url), 2000);

                        // Clean up
                        document.body.removeChild(reportContainer);
                        btn.innerHTML = originalHTML; // Restore original HTML (with data attributes)
                        btn.disabled = false;
                    }).catch(err => {
                        console.error('PDF Export Error:', err);
                        document.body.removeChild(reportContainer);
                        alert(currentLang === 'ar' ? 'ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿµÿØŸäÿ±' : 'Export error occurred');
                        btn.innerHTML = originalHTML;
                        btn.disabled = false;
                    });
                }, 500); // 500ms delay for stability
            } catch (error) {
                console.error('Export error:', error);
                const btn = event.target.closest('button');
                if (btn) btn.disabled = false;
            }
        }


        function exportJSON() {
            if (!currentAnalysis) {
                alert(i18n[currentLang].noAnalysis || 'Please analyze text first');
                return;
            }

            try {
                const data = {
                    // Meta information
                    exportedAt: new Date().toISOString(),
                    appVersion: '2.0',
                    language: currentAnalysis.language,

                    // Main results
                    results: {
                        classification: currentAnalysis.prediction.classification,
                        scores: {
                            ai: parseFloat(currentAnalysis.prediction.aiScore.toFixed(2)),
                            human: parseFloat(currentAnalysis.prediction.humanScore.toFixed(2)),
                            confidence: parseFloat(currentAnalysis.prediction.confidence.toFixed(2))
                        }
                    },

                    // Text statistics
                    statistics: {
                        wordCount: currentAnalysis.analyzer.tokens.length,
                        charCount: currentAnalysis.analyzer.text.length,
                        sentenceCount: currentAnalysis.analyzer.sentences.length,
                        avgSentenceLength: currentAnalysis.analyzer.getAverageSentenceLength().toFixed(2),
                        uniqueWords: new Set(currentAnalysis.analyzer.tokens).size
                    },

                    // Advanced metrics
                    metrics: {
                        entropy: parseFloat(currentAnalysis.prediction.models.stat.entropy.toFixed(3)),
                        perplexity: parseFloat(currentAnalysis.prediction.models.stat.perplexity.toFixed(2)),
                        burstiness: parseFloat(currentAnalysis.prediction.models.stat.burstiness.toFixed(3)),
                        ttr: parseFloat(currentAnalysis.prediction.models.stat.ttr.toFixed(3))
                    },

                    // Model scores
                    modelScores: {
                        statistical: parseFloat(currentAnalysis.prediction.models.stat.aiScore.toFixed(3)),
                        linguistic: parseFloat(currentAnalysis.prediction.models.ling.aiScore.toFixed(3)),
                        stylometric: parseFloat(currentAnalysis.prediction.models.style.aiScore.toFixed(3)),
                        pattern: parseFloat(currentAnalysis.prediction.models.pattern.aiScore.toFixed(3))
                    },

                    // Performance
                    performance: {
                        processingTime: currentAnalysis.processingTime + 'ms',
                        timestamp: new Date().getTime()
                    },

                    // Text sample (first 500 chars)
                    textSample: currentAnalysis.text.substring(0, 500) + (currentAnalysis.text.length > 500 ? '...' : '')
                };

                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `AI_Detection_Report_${Date.now()}.json`;
                link.click();

                // Clean up
                setTimeout(() => URL.revokeObjectURL(url), 100);
            } catch (error) {
                console.error('JSON export failed:', error);
                alert(currentLang === 'ar' ? 'ŸÅÿ¥ŸÑ ÿ™ÿµÿØŸäÿ± JSON' : 'JSON export failed');
            }
        }

        function clearAll() {
            document.getElementById('textInput').value = '';
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('noResults').style.display = 'block';
            document.getElementById('noResults').innerHTML = `<p style="font-size: 1.2em;">${i18n[currentLang].waiting}</p>`;
            document.getElementById('statsDisplay').style.display = 'none';
            currentAnalysis = null;
            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            console.log('‚úÖ AI Text Detection Studio - Enhanced Version');
            console.log('üß† Active Models: Statistical + Linguistic + Stylometric + Pattern');
            console.log('üéØ Target: 99%+ Accuracy with Advanced Multi-Layer Analysis');
            console.log('üìö History System: Enabled');

            // Apply default language (English)
            updateUIText();

            // Load history on startup
            historyManager.updateHistoryUI();
        });
    </script>
    <script src="batch-processing.js"></script>
    
    <!-- Version Footer -->
    <footer style="text-align: center; padding: 20px; background: #2c3e50; color: white; margin-top: 40px;">
        <p style="margin: 5px 0; font-size: 0.75em; opacity: 0.8; font-family: 'Courier New', monospace;">
            v1.2 ‚Ä¢ 14 Jan 2026 ‚Ä¢ 13:55 Amman Local Time
        </p>
    </footer>
</body>

</html>